"use strict";(self.webpackChunk_reneos_3d_editor=self.webpackChunk_reneos_3d_editor||[]).push([[792],{853:(e,t,o)=>{var n={};o.r(n),o.d(n,{ActionsLib:()=>Vt,AssetEdit:()=>Ks,BoolEdit:()=>Nl,CustomInput:()=>Yn,EditColor:()=>us,EulerBlock:()=>ls,ExpandedButton:()=>on,ExtMenu:()=>Wn,FloatInput:()=>_l,FloatValue:()=>Ol,Icon:()=>an,Importer:()=>aa,Int:()=>$l,ItemsLib:()=>Cs,Label:()=>ys,LabelEdit:()=>rs,Modal:()=>hn,ModuleEdit:()=>js,PopupList:()=>kn,Selectable:()=>yl,SimpleButton:()=>wn,SlideBlock:()=>nl,SlideScroller:()=>On,Spinner:()=>xn,Toast:()=>Ln,Toasts:()=>Dn,ToggleButton:()=>Nn,TreeLi:()=>rl,V3:()=>Xl,V3block:()=>Zl,params:()=>Tl,queryform:()=>tl,vlist:()=>El});var l={};o.r(l),o.d(l,{actions:()=>Da,app:()=>Qa,assets:()=>Ma,elements:()=>za,engine:()=>xa,events:()=>ei,inspector:()=>ni,modal:()=>ga,modules:()=>Ba,selection:()=>ja,slides:()=>Ra,toasts:()=>ya});var s=o(655);const a={class:"app-container canvas-container"},i={id:"editorcanvas",ref:"editorcanvas"},c={id:"playcanvas",ref:"playcanvas"},r={class:"absoluteClass",style:{"pointer-events":"none"},ref:"uiroot"},d={class:"container"},p=["onClick"],m={key:0},u={class:"element"},h=["innerHTML"],v=["onClick"],y={key:0},k={class:"panel-container"},f={class:"panel"},g={class:"header"},b={class:"content"},w={class:"footer"},E={methods:{closeModal(){this.$app.project.assets[1].url="gltf|assets/hex.glb"}},props:{header:{type:Object,default:{label:""}},footer:{type:Object,default:{}}},data:()=>({visible:{heirarhy:!0}})};var B=o(262);const V=(0,B.A)(E,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",k,[(0,s.createElementVNode)("div",f,[(0,s.createElementVNode)("div",g,[(0,s.renderSlot)(e.$slots,"header")]),(0,s.createElementVNode)("div",b,[(0,s.renderSlot)(e.$slots,"default")]),(0,s.createElementVNode)("div",w,[(0,s.renderSlot)(e.$slots,"footer")])])])}]]),N={class:"slide-scroller",ref:"scroller"},C=["onClick"],S={class:"title"},x={class:"overflow"},$={props:{slides:{type:Array,required:!0},slide:{type:Object}},data:()=>({newslideform:!1,slideData:{name:{label:"Имя",value:""}},translateX:0}),mounted(){this.centerSelectedImage()},watch:{slide(){this.centerSelectedImage()}},methods:{addSlide(){this.$app.modal.open({header:{value:"Новый слайд",handler:()=>{this.$app.modal.close(),this.newslideform=!1}},content:{},footer:{handler:()=>{this.$app.modal.close(),this.newslideform=!1,this.$app.slides.createSlide({name:this.slideData.name.value})}}}),this.newslideform=!0},selectSlide(e){this.$app.slides.goto(e.uid)},centerSelectedImage(){this.$nextTick((()=>{const e=this.$refs.scroller.offsetWidth,t=this.$refs.scroller.querySelector(".slide-item.selected");if(t){const o=t.offsetWidth,n=t.offsetLeft;this.translateX=-(n-e/2+o/2)}}))}}},A=(0,B.A)($,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("icon"),c=(0,s.resolveComponent)("queryform"),r=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",N,[(0,s.createElementVNode)("div",{class:"slide-container",style:(0,s.normalizeStyle)({transform:`translateX(${l.translateX}px)`})},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.slides,((e,n)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:n,class:(0,s.normalizeClass)(["slide-item",{selected:e===o.slide}]),onClick:t=>a.selectSlide(e)},[(0,s.createElementVNode)("div",S,(0,s.toDisplayString)(e.name),1),t[2]||(t[2]=(0,s.createElementVNode)("img",{src:"contents/cardbg.png",alt:"Image"},null,-1))],10,C)))),128)),(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",{class:"slide-item",onClick:t[0]||(t[0]=e=>a.addSlide())},[t[3]||(t[3]=(0,s.createElementVNode)("img",{src:"contents/cardbg.png",alt:"Image"},null,-1)),(0,s.createElementVNode)("div",x,[(0,s.createVNode)(i,{value:"plus",size:"1em"})])])),[[r,"Add slide"]])],4),l.newslideform?((0,s.openBlock)(),(0,s.createBlock)(s.Teleport,{key:0,to:".modal-content"},[(0,s.createVNode)(c,{"onUpdate:values":t[1]||(t[1]=e=>l.slideData=e),values:l.slideData},null,8,["values"])])):(0,s.createCommentVNode)("v-if",!0)],512)}],["__scopeId","data-v-66185c6e"]]),D={class:"panel-container"},I={class:"panel"},T={key:0,class:"content"},M={class:"elements"},L={data:()=>({visible:!1})},j=(0,B.A)(L,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",D,[(0,s.createElementVNode)("div",I,[(0,s.createElementVNode)("div",{onClick:t[0]||(t[0]=e=>l.visible=!l.visible),class:"header"},"Hierarhy"),l.visible?((0,s.openBlock)(),(0,s.createElementBlock)("div",T,[(0,s.createElementVNode)("div",M,[(0,s.renderSlot)(e.$slots,"default",{},void 0,!0)])])):(0,s.createCommentVNode)("v-if",!0)])])}],["__scopeId","data-v-e71891a0"]]),_={key:0,class:"element"},F={class:"blockcontent"},z={key:1,class:"label"},U={name:"NameEditor",props:{selected:{type:Object},label:{type:String}},methods:{onChangeName(e){this.selected.name=e}}},O=(0,B.A)(U,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("LabelEdit");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createVNode)(i,{label:o.label,"onUpdate:value":t[0]||(t[0]=e=>a.onChangeName(e)),value:o.selected.name||o.selected.model?.name||o.selected.uid},null,8,["label","value"])])}]]),P={style:{display:"grid","grid-template-columns":"96px 1fr"}},R=["value"],H={key:1},W={name:"ModelTypes",data:()=>({types:["model","camera","chart3d"]}),props:{selected:{type:Object}}},q=(0,B.A)(W,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",P,[t[1]||(t[1]=(0,s.createElementVNode)("div",null,"Тип:",-1)),l.types.includes(o.selected.type)?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("select",{key:0,class:"typeslist","onUpdate:modelValue":t[0]||(t[0]=e=>o.selected.type=e)},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(l.types,(e=>((0,s.openBlock)(),(0,s.createElementBlock)("option",{value:e},(0,s.toDisplayString)(e),9,R)))),256))],512)),[[s.vModelSelect,o.selected.type]]):((0,s.openBlock)(),(0,s.createElementBlock)("div",H,(0,s.toDisplayString)(o.selected.type),1))])}]]),X={class:"transform-container"},J={class:"label"},Y={key:0,class:"transforms"},K={key:1},G={key:3},Z={key:5};var Q=o(125),ee=o(24),te=o(0);function oe(e){return 180*e/Math.PI}function ne(e){return e*Math.PI/180}let le,se,ae;class ie{static FocusTo(e){le.target.copy(e.isObject3D?e.position:e)}static MoveTo(e,t){const o={position:new Q.Vector3,time:1e3,...e,control:!1},n={position:new Q.Vector3,time:1e3,...t,control:!1};le.enabled=!1;const l=Workspace.Camera.position.clone(),s=le.target.clone();o.control=o.time>n.time,n.control=n.time>=o.time;const a=new Tween(l).to(o.position,o.time).easing(Easing.Quadratic.InOut).onUpdate((()=>{Workspace.Camera.position.copy(l),Workspace.Camera.updateProjectionMatrix(),le.update()})).onComplete((()=>{o.control&&(le.enabled=!0),tweengroup.remove(a)})).start(),i=new Tween(s).to(n.position,n.time).easing(Easing.Quadratic.InOut).onUpdate((()=>{le.target.copy(s),le.getPolarAngle()>le.maxPolarAngle&&le.target.setY(center.y+Math.cos(le.maxPolarAngle)*distance)})).onComplete((()=>{n.control&&(le.enabled=!0),tweengroup.remove(i)})).start();tweengroup.add(a,i)}static SetState(e){le.enabled=e}static Init({canvas:e},t,o){ae=t,le=new ee.N(t,e),le.enabled=!0,le.enableDamping=!0,le.dampingFactor=.25,le.screenSpacePanning=!1,le.minDistance=.01,le.maxDistance=500,se=new te.ZU(t,e),se.addEventListener("dragging-changed",(e=>{le.enabled=!e.value}));const n=se.getHelper();o.add(n),se.getRaycaster().layers.set(1),n.traverse((e=>{e.layers.set(1)})),window.addEventListener("keydown",(e=>{switch(le.enabled=!e.ctrlKey,e.code){case"KeyQ":se.setSpace("local"===se.space?"world":"local");break;case"Shift":se.setTranslationSnap(1),se.setRotationSnap(Q.MathUtils.degToRad(15)),se.setScaleSnap(.25);break;case"KeyW":se.setMode("translate");break;case"KeyE":se.setMode("rotate");break;case"KeyR":se.setMode("scale");break;case"KeyF":se.object&&function(e){if(!e.object)return void console.warn("Нет выбранного объекта в TransformControls!");const t=e.object,o=new Q.Box3;t.traverse((e=>{o.expandByObject(e)}));const n=new Q.Sphere;o.getBoundingSphere(n),ie.FitTo(n)}(se);break;case"KeyC":case"KeyV":break;case"+":case"=":se.setSize(se.size+.1);break;case"-":case"_":se.setSize(Math.max(se.size-.1,.1));break;case"KeyX":se.showX=!se.showX;break;case"KeyY":se.showY=!se.showY;break;case"KeyZ":se.showZ=!se.showZ;break;case" ":se.enabled=!se.enabled;break;case"Escape":se.reset()}})),window.addEventListener("keyup",(e=>{le.enabled=!e.ctrlKey,"Shift"===e.key&&(se.setTranslationSnap(null),se.setRotationSnap(null),se.setScaleSnap(null))}))}static get Transformer(){return se}static Select(e){e?se.attach(e):se.detach()}static Update(e){le.update(e)}static FitTo({center:e,radius:t}){const o=ne(ae.fov),n=t/Math.sin(o/2),l=(new Q.Vector3).subVectors(ae.position,e).normalize(),s=e.clone().add(l.multiplyScalar(n));ae.position.clone(),le.enabled=!1,le.target.clone(),function(e,t,o=1){const n=o,l=ae.position.clone(),s=le.target.clone(),a=Date.now();!function o(){const i=(Date.now()-a)/(1e3*n);if(i>=1)return ae.position.copy(e),le.target.copy(t),void le.update();ae.position.lerpVectors(l,e,i),le.target.lerpVectors(s,t,i),le.update(),requestAnimationFrame(o)}()}(s,e,.5)}}const ce=ie,re={data:()=>({expanded:!0}),props:{selected:{type:Object,default:null}},computed:{model(){return this.selected.model},values(){return this.selected.data},state(){return this.selected.state}},watch:{selected:{handler(e,t){t&&this.restoreModelTransform(t),this.applyModelTransform(e)}}},beforeUnmount(){this.selected&&(this.restoreModelTransform(this.selected),ce.Transformer.removeEventListener("objectChange",this.onTransformerEvent))},mounted(){ce.Transformer.addEventListener("objectChange",this.onTransformerEvent),this.applyModelTransform(this.selected)},methods:{restoreModelTransform(e){e.state&&e.isState&&e.state.activate()},applyModelTransform(e){e.data.position&&e.model.position.copy(e.data.position),e.data.rotation&&e.model.rotation.setFromVector3(e.data.rotation,"XYZ"),e.data.scale&&e.model.scale.copy(e.data.scale)},assignFromModel(e){this.selected.data[e]=this.selected.model[e].clone(),this.selected[e]=this.selected.data[e].clone()},onTransformerEvent(e){const t=ce.Transformer.object;switch(ce.Transformer.mode){case"translate":this.selected.data.position||this.assignFromModel("position"),this.selected.position.copy(t.model.position),this.selected.data.position=this.selected.position.clone();break;case"rotate":this.selected.data.rotation||this.assignFromModel("rotation"),this.selected.rotation.copy(t.model.rotation),this.selected.data.rotation={x:this.selected.rotation.x,y:this.selected.rotation.y,z:this.selected.rotation.z};break;case"scale":this.selected.scale||this.assignFromModel("scale"),this.selected.scale.copy(t.model.scale),this.selected.data.scale=this.selected.scale.clone()}this.$emit("modify")},async onChangeTransform(e,t){switch(e){case"position":this.selected.data.position||this.assignFromModel("position"),this.selected.position.copy(t),this.selected.data.position=this.selected.position.clone(),this.selected.model.position.copy(t);break;case"rotation":this.selected.rotation||(this.selected.rotation=new Q.Euler),this.selected.rotation.setFromVector3(t),this.selected.model.rotation.copy(this.selected.rotation);break;case"scale":this.selected.scale||(this.selected.scale=new Q.Vector3),this.selected.scale.copy(t),this.selected.model.scale.copy(this.selected.scale)}this.$emit("modify")}}},de=(0,B.A)(re,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("icon"),c=(0,s.resolveComponent)("V3block"),r=(0,s.resolveComponent)("EulerBlock"),d=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createElementVNode)("div",X,[(0,s.createElementVNode)("div",J,[(0,s.createElementVNode)("div",{class:"title",onClick:t[0]||(t[0]=e=>l.expanded=!l.expanded)},(0,s.toDisplayString)(l.expanded?"▼":"▶")+" Трансформ:",1),(0,s.createCommentVNode)("v-if",!0)]),l.expanded?((0,s.openBlock)(),(0,s.createElementBlock)("div",Y,[o.selected.position?((0,s.openBlock)(),(0,s.createBlock)(c,{key:0,"onUpdate:values":t[4]||(t[4]=e=>a.onChangeTransform("position",e)),label:"Position",step:.1,values:o.selected.position,decimals:4},{tools:(0,s.withCtx)((()=>[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{class:"square",onClick:t[3]||(t[3]=t=>e.removeTransform("position"))},[(0,s.createVNode)(i,{value:"bin",size:"1em"})])),[[d,"Удалить позицию"]])])),_:1},8,["values"])):((0,s.openBlock)(),(0,s.createElementBlock)("div",K,[(0,s.createElementVNode)("button",{class:"copybutton",onClick:t[5]||(t[5]=e=>a.assignFromModel("position"))},"Копировать позицию модели")])),o.selected.rotation?((0,s.openBlock)(),(0,s.createBlock)(r,{key:2,"onUpdate:values":t[7]||(t[7]=e=>a.onChangeTransform("rotation",e)),label:"Rotation",step:1,decimals:0,values:o.selected.rotation},{tools:(0,s.withCtx)((()=>[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{class:"square",onClick:t[6]||(t[6]=t=>e.removeTransform("rotation"))},[(0,s.createVNode)(i,{value:"bin",size:"1em"})])),[[d,"Удалить вращение"]])])),_:1},8,["values"])):((0,s.openBlock)(),(0,s.createElementBlock)("div",G,[(0,s.createElementVNode)("button",{class:"copybutton",onClick:t[8]||(t[8]=e=>a.assignFromModel("rotation"))},"Копировать вращение модели")])),o.selected.scale?((0,s.openBlock)(),(0,s.createBlock)(c,{key:4,"onUpdate:values":t[10]||(t[10]=e=>a.onChangeTransform("scale",e)),label:"Scale",step:.01,values:o.selected.scale},{tools:(0,s.withCtx)((()=>[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{class:"square",onClick:t[9]||(t[9]=t=>e.removeTransform("scale"))},[(0,s.createVNode)(i,{value:"bin",size:"1em"})])),[[d,"Удалить размер"]])])),_:1},8,["values"])):((0,s.openBlock)(),(0,s.createElementBlock)("div",Z,[(0,s.createElementVNode)("button",{class:"copybutton",onClick:t[11]||(t[11]=e=>a.assignFromModel("scale"))},"Копировать размер модели")]))])):(0,s.createCommentVNode)("v-if",!0)])])}]]),pe={style:{display:"flex","flex-direction":"column"}},me={style:{display:"flex","justify-content":"center","margin-top":"10px"}},ue={class:"assetblock"},he={key:0,class:"short"},ve={class:"short-text"},ye={key:0,class:"assetcontent"},ke={class:"assetrow"},fe={class:"assetrow"},ge={name:"AssetView",props:{asset:{type:Object},label:{type:String}},mounted(){},data:()=>({view:!0}),computed:{src(){return this.$app.assets.list.find((e=>e.uid===this.asset.uid))},types(){return this.$app.assets.types}}},be=(0,B.A)(ge,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("icon"),c=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",ue,[(0,s.createElementVNode)("div",{onClick:t[0]||(t[0]=e=>l.view=!l.view),class:"title"},[(0,s.createCommentVNode)(' <div class="label">{{ label }}</div> '),l.view?(0,s.createCommentVNode)("v-if",!0):((0,s.openBlock)(),(0,s.createElementBlock)("div",he,[(0,s.createTextVNode)((0,s.toDisplayString)(a.src.uid)+" : "+(0,s.toDisplayString)(a.src.type)+" : ",1),(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",ve,[(0,s.createTextVNode)((0,s.toDisplayString)(a.src.url),1)])),[[c,a.src.url]])]))]),l.view?((0,s.openBlock)(),(0,s.createElementBlock)("div",ye,[(0,s.createElementVNode)("div",ke,[(0,s.createElementVNode)("div",null,(0,s.toDisplayString)(a.src.type)+" : "+(0,s.toDisplayString)(a.src.name||a.src.uid),1),(0,s.createElementVNode)("div",null,[(0,s.createElementVNode)("button",{onClick:t[1]||(t[1]=t=>e.$emit("remove",o.asset.uid))},[(0,s.createVNode)(i,{value:"bin",size:"1em"})])])]),(0,s.createCommentVNode)(' <div class="assetrow">\r\n                <div>URL:</div>\r\n                <div class="rowcontent">\r\n                    <LabelEdit :value="src.url"></LabelEdit>\r\n                </div>\r\n            </div> '),(0,s.createCommentVNode)(' <div class="assetrow" v-for="(param, key) in src.parameters">\r\n            <div>{{ key }}</div><div>{{ param }}</div>\r\n        </div> '),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.asset.parameters,((e,o)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",fe,[(0,s.createElementVNode)("div",null,(0,s.toDisplayString)(o),1),t[2]||(t[2]=(0,s.createElementVNode)("div",{class:"cell"},[(0,s.createCommentVNode)(' <LabelEdit @update:value="asset.parameters[key] = $event; $emit(\'changed\')" :value="param">\r\n                    </LabelEdit> ')],-1))])))),256))])):(0,s.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-40f78f3e"]]),we={name:"AssetsView",data:()=>({selectedAsset:null,assetsData:{offtypes:["hdr"]}}),props:{selected:{type:Object}},methods:{removeAsset(e){this.$app.elements.removeElementAsset(this.selected.path,e)},saveProp(){this.$app.toasts.add({message:"Параметр ресурса в элементе изменен"}),this.$app.engine.getManager().UpdateElement(this.selected.path,{assets:this.selected.assets})},selectAsset(){this.$app.assets.selectAsset([],(e=>{this.selected.assets||(this.selected.assets=[]),this.selected.assets.push({uid:e.uid});const t=this.$app.engine.getManager("AssetsManager").GetAsset(e.uid);this.selected.model.setAsset(t),this.selected.model.data.assets||(this.selected.model.data.assets=[]),this.selected.model.data.assets.push({uid:t.uid}),this.$app.elements.save(this.selected)}))}},computed:{list(){return this.selected.data?.assets||this.selected.assets||[]}},components:{AssetView:be}},Ee=(0,B.A)(we,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("AssetView"),c=(0,s.resolveComponent)("icon"),r=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",pe,[t[1]||(t[1]=(0,s.createElementVNode)("div",null,"Ресурсы",-1)),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(a.list,((e,t)=>((0,s.openBlock)(),(0,s.createBlock)(i,{asset:e,key:t,onRemove:a.removeAsset,onChanged:a.saveProp},null,8,["asset","onRemove","onChanged"])))),128)),(0,s.createElementVNode)("div",me,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{class:"button normal",onClick:t[0]||(t[0]=(...e)=>a.selectAsset&&a.selectAsset(...e))},[(0,s.createVNode)(c,{value:"stack",size:"0.75em"})])),[[r,"Ресурсы"]])])])}]]),Be=Ee,Ve={class:"assetblock"},Ne={class:"assetcontent"},Ce={class:"assetrow"},Se={class:"label"},xe={style:{display:"block"}},$e={class:"overleyicon"},Ae={name:"AssetView",props:{asset:{type:Object}},data:()=>({}),methods:{showLib(){this.$app.assets.selectAsset(["gltf","texture"],(e=>{this.$emit("setasset",e)}))}}},De=(0,B.A)(Ae,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",xe,[(0,s.createElementVNode)("div",$e,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",{onClick:t[0]||(t[0]=(...e)=>a.showLib&&a.showLib(...e)),class:"text"},[(0,s.createTextVNode)((0,s.toDisplayString)(o.asset.name||o.asset.uid),1)])),[[i,o.asset.url]])])])}],["__scopeId","data-v-154a55dc"]]),Ie={texture:"image",gltf:"cube",hdr:"cloud"},Te={hdr:"assethdr"},Me={name:"AssetView",props:{selected:{type:Object},label:{type:String},property:{type:Object}},mounted(){},data:()=>({view:!0}),methods:{onAssetChange(e){this.selected[this.property.prop]=e.uid,this.$app.engine.getManager("AssetsManager").UpdateAsset(this.selected,this.property.prop,(()=>{}))},getTypeIcon:e=>Ie[e]},computed:{val(){return this.selected[this.property.prop]},asset(){return this.$app.assets.list.find((e=>e.uid===this.val))},cmp(){return Te[this.asset.type]}},components:{assethdr:De}},Le=(0,B.A)(Me,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Ve,[(0,s.createElementVNode)("div",Ne,[(0,s.createElementVNode)("div",Ce,[(0,s.createElementVNode)("div",Se,(0,s.toDisplayString)(o.label),1),((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(a.cmp),{onSetasset:a.onAssetChange,asset:a.asset},null,40,["onSetasset","asset"]))])])])}],["__scopeId","data-v-b983c3a0"]]),je={class:"container"},_e={class:"info"},Fe={class:"row"},ze={class:"rowvalue"},Ue={class:"row"},Oe={class:"rowvalue"},Pe=["value"],Re={class:"rowline"},He=["value"],We=["value"],qe=["value"],Xe=["value"],Je=["value"],Ye={name:"Assets",data:()=>({current:null}),props:{callback:{type:Function},property:{type:Object}},computed:{list(){return this.$app.project.assets},types:()=>["float","bool","color","string","asset","vector2","vector3","vector4","quaternion"]},methods:{checkType:e=>typeof e,selectAsset(e){this.current=e,this.callback(this.current)}}},Ke=(0,B.A)(Ye,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("LabelEdit");return(0,s.openBlock)(),(0,s.createElementBlock)("div",je,[(0,s.createElementVNode)("div",_e,[(0,s.createElementVNode)("div",Fe,[t[7]||(t[7]=(0,s.createElementVNode)("div",{class:"rowlabel"},"Свойство",-1)),(0,s.createElementVNode)("div",ze,[(0,s.createVNode)(i,{style:{width:"100%"},"onUpdate:value":t[0]||(t[0]=e=>o.property.name=e),value:o.property.name},null,8,["value"])])]),(0,s.createElementVNode)("div",Ue,[t[8]||(t[8]=(0,s.createElementVNode)("div",{class:"rowlabel"},"Тип",-1)),(0,s.createElementVNode)("div",Oe,[(0,s.withDirectives)((0,s.createElementVNode)("select",{class:"typeslist","onUpdate:modelValue":t[1]||(t[1]=e=>o.property.type=e)},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(a.types,(e=>((0,s.openBlock)(),(0,s.createElementBlock)("option",{value:e},(0,s.toDisplayString)(e),9,Pe)))),256))],512),[[s.vModelSelect,o.property.type]])])]),(0,s.createElementVNode)("div",Re,["bool"===o.property.type?((0,s.openBlock)(),(0,s.createElementBlock)("input",{key:0,type:"checkbox",value:o.property.value,"onUpdate:value":t[2]||(t[2]=e=>o.property.value=e)},null,40,He)):(0,s.createCommentVNode)("v-if",!0),"number"===o.property.type?((0,s.openBlock)(),(0,s.createElementBlock)("input",{key:1,type:"number",value:o.property.value,"onUpdate:value":t[3]||(t[3]=e=>o.property.value=e)},null,40,We)):(0,s.createCommentVNode)("v-if",!0),"string"===o.property.type?((0,s.openBlock)(),(0,s.createElementBlock)("input",{key:2,type:"text",value:o.property.value,"onUpdate:value":t[4]||(t[4]=e=>o.property.value=e)},null,40,qe)):(0,s.createCommentVNode)("v-if",!0),"color"===o.property.type?((0,s.openBlock)(),(0,s.createElementBlock)("input",{key:3,type:"color",value:o.property.value,"onUpdate:value":t[5]||(t[5]=e=>o.property.value=e)},null,40,Xe)):(0,s.createCommentVNode)("v-if",!0),"image"===o.property.type?((0,s.openBlock)(),(0,s.createElementBlock)("input",{key:4,type:"image",value:o.property.value,"onUpdate:value":t[6]||(t[6]=e=>o.property.value=e)},null,40,Je)):(0,s.createCommentVNode)("v-if",!0)])])])}],["__scopeId","data-v-f1f0f914"]]),Ge={class:"scenetools"},Ze={key:0,class:"sceneassets"},Qe={data:()=>({asset:{uid:"hdrscene"},view:!0}),name:"SceneTools"},et=(0,B.A)(Qe,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Ge,[(0,s.createElementVNode)("div",{onClick:t[0]||(t[0]=e=>l.view=!l.view)},"Параметры сцены:"),l.view?((0,s.openBlock)(),(0,s.createElementBlock)("div",Ze,[(0,s.createCommentVNode)(' <AssetView label="Окружение" :asset="asset"> </AssetView> ')])):(0,s.createCommentVNode)("v-if",!0)])}]]),tt={class:"blocks-container"},ot={class:"blockslabel"},nt={key:1,class:"blocks"},lt={class:"blocklabel"},st={class:"blocktitle"},at=["onClick"],it={class:"textwrap w100 tcenter"},ct={class:"textwrap w100 tcenter"},rt={class:"actionview"},dt={class:"actionrow"},pt={key:0},mt={key:0,class:"buttons"},ut={class:"actionform"},ht={props:{value:{type:Object,default:{uid:""}},isState:{type:Boolean,default:!1}},data:()=>({expanded:!1,editform:null,played:!1}),computed:{action(){return this.$app.actions.list[this.value.uid]}},methods:{remove(){},play(e){this.$refs[`action${this.action.type}`].play()},reset(){this.$refs[`action${this.action.type}`].reset()},showEditForm(e){this.$app.modal.open({header:{value:`Редактировать ${this.value.uid} эффект`,handler:()=>{this.$app.modal.close(),this.editform=null}},content:{},footer:{}}),this.editform=e.type}}},vt=(0,B.A)(ht,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",rt,[(0,s.createElementVNode)("div",dt,[(0,s.createElementVNode)("div",{class:"label",onClick:t[0]||(t[0]=e=>l.expanded=!l.expanded)},[(0,s.createTextVNode)((0,s.toDisplayString)(l.expanded?"▼":"▶")+" "+(0,s.toDisplayString)(o.value.uid)+" ",1),o.isState?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("span",pt,t[1]||(t[1]=[(0,s.createTextVNode)("(S)")]))),[[i,"На состоянии"]]):(0,s.createCommentVNode)("v-if",!0)]),(0,s.createCommentVNode)(' <div style="overflow: hidden; text-overflow: ellipsis;">{{ action.type }}</div> '),(0,s.createCommentVNode)(' <div style="overflow: hidden; text-overflow: ellipsis;">{{ value.uid }} </div> '),l.expanded?(0,s.createCommentVNode)("v-if",!0):((0,s.openBlock)(),(0,s.createElementBlock)("div",mt,[(0,s.createCommentVNode)(' <button @click="play">\r\n                        <icon :value="played ? \'stop2\' : \'play3\'" size="1.2em"></icon>\r\n                    </button>\r\n                    <button @click="reset">\r\n                        <icon value="undo" size="1em"></icon>\r\n                    </button>\r\n                    <button @click="remove">\r\n                        <icon value="bin" size="1em"></icon>\r\n                    </button> ')]))]),(0,s.withDirectives)((0,s.createElementVNode)("div",ut,[(0,s.createCommentVNode)(' <component @play="played=$event" :ref="`action${action.type}`" :actionuid="value.uid" :is="action.type"> '),(0,s.createCommentVNode)(' <div class="line">\r\n                    <button @click="play" style="padding: 5px;aspect-ratio: 1/1;">\r\n                        <icon :value="played ? \'stop2\' : \'play3\'" size="1.5em"></icon>\r\n                    </button>\r\n                    <button @click="reset" style="padding: 5px;aspect-ratio: 1/1;">\r\n                        <icon value="undo" size="1.5em"></icon>\r\n                    </button>\r\n                    <button @click="remove" style="padding: 5px;aspect-ratio: 1/1;">\r\n                        <icon value="bin" size="1.5em"></icon>\r\n                    </button>\r\n                </div> '),(0,s.createCommentVNode)(" </component> ")],512),[[s.vShow,l.expanded]]),l.editform?((0,s.openBlock)(),(0,s.createBlock)(s.Teleport,{key:0,to:".modal-content"},[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(l.editform),{actionuid:o.value.uid},null,8,["actionuid"]))])):(0,s.createCommentVNode)("v-if",!0)])}]]),yt=["onMouseover","onClick"],kt={props:["items","menuX","menuY"],data:()=>({isActive:!1,highlightedIndex:null}),methods:{highlight(e){this.highlightedIndex=e},deactivate(){this.highlightedIndex=null,this.$emit("select",null)},selectItem(e){this.$emit("select",e)}}},ft=(0,B.A)(kt,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",{class:"menu",onMouseleave:t[0]||(t[0]=(...e)=>a.deactivate&&a.deactivate(...e)),style:(0,s.normalizeStyle)({top:o.menuY-3+"px",left:o.menuX+"px"})},[(0,s.createElementVNode)("ul",null,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.items,((e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("li",{key:t,onMouseover:e=>a.highlight(t),onClick:t=>a.selectItem(e),class:(0,s.normalizeClass)({highlighted:l.highlightedIndex===t})},(0,s.toDisplayString)(e),43,yt)))),128))])],36)}],["__scopeId","data-v-02225f92"]]),gt={class:"textwrap w100 tcenter"},bt={class:"textwrap w100 tcenter"},wt={key:0,style:{"min-width":"256px",height:"100%",display:"flex","justify-content":"center","align-items":"center"}},Et={tweens:"move-up"},Bt={name:"ActionsLib",props:{selected:{type:Object},regbusy:!1,register:{type:Array}},data:()=>({current:null}),computed:{actions(){return this.$app.actions}},emits:["selectItem"],methods:{onAssetEdit(e,t){this.current[e],this.current[e]=t},getTypeIcon:e=>Et[e],checkType:e=>typeof e,select(e){this.current=e,this.$emit("selectItem",e)},endEdit(){this.$refs.assetEditor.end()}}},Vt=(0,B.A)(Bt,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("spinner"),c=(0,s.resolveComponent)("queryform"),r=(0,s.resolveComponent)("Selectable"),d=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createBlock)(s.Teleport,{to:".modal-content"},[(0,s.createVNode)(r,{onSelectItem:a.select,list:a.actions.library,selected:o.selected},(0,s.createSlots)({item:(0,s.withCtx)((({item:e})=>[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",gt,[(0,s.createTextVNode)((0,s.toDisplayString)(e.component),1)])),[[d,e.component]]),(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",bt,[(0,s.createTextVNode)((0,s.toDisplayString)(e.type),1)])),[[d,e.type]])])),_:2},[o.register?{name:"selected",fn:(0,s.withCtx)((({item:e})=>[o.regbusy?((0,s.openBlock)(),(0,s.createElementBlock)("div",wt,[(0,s.createVNode)(i)])):((0,s.openBlock)(),(0,s.createBlock)(c,{key:1,values:o.register},null,8,["values"]))])),key:"0"}:void 0]),1032,["onSelectItem","list","selected"])])}]]),Nt={tweens:"move-up"},Ct={name:"EventsList",props:{selected:{type:Object}},computed:{eventTypes(){return this.$app.events.types},actions(){return this.$app.actions}},mounted(){},methods:{getActionsHooks(){return this.selected.actions?[...new Set(this.selected.actions.map((e=>e.hook)))]:[]},getActionsByHook(e){return this.selected.actions.filter((t=>t.hook===e))},getActionRowStyle(e){return this.selectdAction===e?{color:"#eeee80e3"}:{}},onActionSelect(e){this.selectdAction||this.actsButtons.unshift({label:"Выбрать",handler:()=>{this.addAction(this.selectdAction),this.actListShow=!1,this.$app.modal.close()}}),this.selectdAction=e},getTypeIcon:e=>Nt[e],onActionsTypeSelect(e){this.selectedActionType=e,this.actLibShow=!1},onSelectEvent(e){e&&this.openActionsList(e),this.listshow=!1},addAction(e){this.selected.addAction({hook:this.eventType,uid:e.uid})},openActionLib(e){this.actsButtons.length=0,this.actsButtons.push({label:"Регистрация",class:"primary normal",handler:()=>{this.regActType=[{id:"name",label:"Имя модуля",value:"modules"},{id:"entry",label:"Ссылка",value:"/modules/mod.mf.js"},{id:"ui",label:"Компонент UI",value:"TweenScaleUI"},{id:"action",label:"Скрипт",value:"TweenScale"}],this.actsButtons.unshift({label:"Добавить модуль",class:"secondary normal",handler:async()=>{this.actsButtons.shift(),this.regbusy=!0,await this.$app.actions.registerActionComponent(this.regActType),this.regActType=null,this.regbusy=!1}})}},{label:"Назад",class:"secondary normal",handler:()=>{this.actLibShow=!1,e()}}),this.$app.modal.open({header:{value:"Список доступных типов обработчиков",handler:()=>{this.$app.modal.close(),this.actLibShow=!1,e()}},content:{},footer:{buttons:this.actsButtons}}),this.actLibShow=!0},openActionsList(e){this.eventType=e,this.selected.actions[e]||(this.selected.actions[e]=[]),this.selectdAction=null,this.actsButtons.length=0,this.actsButtons.push({label:"Закрыть",class:"secondary normal",handler:()=>{this.$app.modal.close(),this.actListShow=!1}}),this.$app.modal.open({header:{value:"Список используемых в проекте обработчиков",handler:()=>{this.$app.modal.close(),this.actListShow=!1}},content:{},footer:{buttons:this.actsButtons}}),this.actListShow=!0},addEvent(e){this.selected.actions||(this.selected.actions=[]),this.events.length=0,this.events.push(...["create.on","enable.on","disable.on","mouse.over","mouse.out"].filter((e=>!this.getActionsHooks().includes(e)))),this.menuX=e.clientX,this.menuY=e.clientY,this.listshow=!0}},data:()=>({actLibShow:!1,actListShow:!1,actsButtons:[],regActType:null,selectedActionType:null,regbusy:!1,selectdAction:null,eventType:"",listshow:!1,show:!0,events:[],menuX:0,menuY:0}),components:{Action:vt,EventsListPopup:ft,ActionsLib:Vt}},St=(0,B.A)(Ct,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("icon"),c=(0,s.resolveComponent)("EventsListPopup"),r=(0,s.resolveComponent)("Action"),d=(0,s.resolveComponent)("Selectable"),p=(0,s.resolveComponent)("ActionsLib"),m=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",tt,[(0,s.createElementVNode)("div",ot,[(0,s.createElementVNode)("div",{onClick:t[0]||(t[0]=e=>l.show=!l.show)},"События : "),(0,s.createElementVNode)("button",{onClick:t[1]||(t[1]=(...e)=>a.addEvent&&a.addEvent(...e))},[(0,s.createVNode)(i,{value:"plus",size:"0.9em"})])]),l.listshow?((0,s.openBlock)(),(0,s.createBlock)(s.Teleport,{key:0,to:"body"},[(0,s.createVNode)(c,{menuX:l.menuX,menuY:l.menuY,items:l.events,onSelect:a.onSelectEvent},null,8,["menuX","menuY","items","onSelect"])])):(0,s.createCommentVNode)("v-if",!0),l.show?((0,s.openBlock)(),(0,s.createElementBlock)("div",nt,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(a.getActionsHooks(),((e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:t,class:"block"},[(0,s.createElementVNode)("div",lt,[(0,s.createElementVNode)("div",st,(0,s.toDisplayString)(e),1),(0,s.createElementVNode)("button",{onClick:t=>a.openActionsList(e)},[(0,s.createVNode)(i,{value:"plus",size:"0.9em"})],8,at)]),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.selected.model.actions.filter((t=>t.hook===e)),((e,t)=>((0,s.openBlock)(),(0,s.createBlock)(r,{value:e,key:t},null,8,["value"])))),128)),o.selected.isState?((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,{key:0},(0,s.renderList)(o.selected.stateActions.filter((t=>t.hook===e)),((e,t)=>((0,s.openBlock)(),(0,s.createBlock)(r,{isState:!0,value:e,key:t},null,8,["value"])))),128)):(0,s.createCommentVNode)("v-if",!0)])))),128))])):(0,s.createCommentVNode)("v-if",!0),l.actListShow?((0,s.openBlock)(),(0,s.createBlock)(s.Teleport,{key:2,to:".modal-content"},[(0,s.createCommentVNode)(' <vlist :list="actions.values" :selected="selectdAction" @selectItem="onActionSelect">\r\n                <template #item="{ item }">\r\n                    <div v-tooltip="item.uid" :style="getActionRowStyle(item)">\r\n                        {{ item.uid }}\r\n                    </div>\r\n                    <div v-tooltip="item.type" :style="getActionRowStyle(item)">\r\n                        {{ item.type }}\r\n                    </div>\r\n                </template>\r\n</vlist> '),(0,s.createVNode)(d,{list:a.actions.values,selected:l.selectdAction,onSelectItem:a.onActionSelect},(0,s.createSlots)({item:(0,s.withCtx)((({item:e})=>[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",it,[(0,s.createTextVNode)((0,s.toDisplayString)(e.uid),1)])),[[m,e.uid]]),(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",ct,[(0,s.createTextVNode)((0,s.toDisplayString)(e.type),1)])),[[m,e.type]])])),_:2},[l.selectdAction?{name:"selected",fn:(0,s.withCtx)((({item:e})=>[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(e.type),{actionuid:e.uid},null,8,["actionuid"]))])),key:"0"}:void 0]),1032,["list","selected","onSelectItem"])])):(0,s.createCommentVNode)("v-if",!0),l.actLibShow?((0,s.openBlock)(),(0,s.createBlock)(s.Teleport,{key:3,to:".modal-content"},[(0,s.createVNode)(p,{onSelectItem:a.onActionsTypeSelect,regbusy:l.regbusy,selected:l.regActType},null,8,["onSelectItem","regbusy","selected"])])):(0,s.createCommentVNode)("v-if",!0)])}]]),xt=St;let $t;const At={data:()=>({showTransform:!0,showAssets:!0,visible:!1,assetsChanged:!1}),methods:{onComponentUpdate(e,t){t.onupdate?t.onupdate(this.selected,e,t,$t):(this.selected.data?this.selected[t.prop]=this.selected.data[t.prop]=e:this.selected[t.prop]=e,$t(this.selected,e,t))},onComponentChange(){$t(this.selected)},addProperty(){let e=(0,s.reactive)({type:Number,name:"value"});const t=(0,s.reactive)({property:e,callback:function(e){}});this.$app.modal.open({header:{value:"Добавить свойство",handler:()=>{this.$app.modal.close()}},content:{component:(0,s.markRaw)(Ke),props:t}})}},computed:{selected(){return this.$app.selection.selected},selectedUID(){return this.$app.selection.uid},blocks(){return[{label:"Наименование",component:"LabelEdit",prop:"name"},{label:"Тип",component:"Label",prop:"type"},...this.$app.inspector.getTypesBlock(this.selected.model?.type||this.selected.type)]}},watch:{selected(e){e?e.isElement?$t=this.$app.elements.save:e.isAsset?$t=this.$app.assets.save:e.isState&&($t=this.$app.slides.saveState):$t=null},"selected.assets.$.parameters":{handler(e,t){t&&e&&(this.assetsChanged=!0)},deep:!0}},components:{NameEdit:O,modeltypes:q,transformedit:de,assetsview:Be,ViewPanel:V,SceneTools:et,EventsList:xt,asset:Le}},Dt=(0,B.A)(At,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("SceneTools"),c=(0,s.resolveComponent)("ViewPanel");return(0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,null,[(0,s.createVNode)(c,{class:"inspector",header:{label:"Инспектор"}},{footer:(0,s.withCtx)((()=>[(0,s.createVNode)(i)])),default:(0,s.withCtx)((()=>[a.selectedUID?((0,s.openBlock)(),(0,s.createElementBlock)("div",_,[(0,s.createCommentVNode)(" <div>{{ selected.paths.join('->') }}</div> "),(0,s.renderSlot)(e.$slots,"default",{},(()=>[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(a.blocks,((e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:t,class:"inspectorblock"},[(0,s.createElementVNode)("div",F,[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(e.component),{class:"blockcomponent",label:e.label,selected:a.selected,value:a.selected[e.prop],property:e,"onUpdate:value":t=>a.onComponentUpdate(t,e),onModify:t=>a.onComponentChange(t,e)},null,40,["label","selected","value","property","onUpdate:value","onModify"]))])])))),128))]))])):((0,s.openBlock)(),(0,s.createElementBlock)("div",z," Выберите элемент или состояние "))])),_:3}),(0,s.createCommentVNode)(' <div class="panel-container">\r\n        <div class="panel">\r\n            <div class="header">Inspector</div>\r\n            <div class="content">\r\n                \r\n            </div>\r\n            <div class="footer">\r\n\r\n            </div>\r\n        </div>\r\n    </div> ')],2112)}]]),It={class:"hierarhy-view"},Tt={class:"title"},Mt={class:"treeicon"},Lt={class:"treecontainer"},jt={class:"roottree"},_t={class:"tree-node"},Ft={class:"tree-node-content"},zt={class:"selector"},Ut=["checked"],Ot={key:0,class:"prepender"},Pt=["title"],Rt={key:1,class:"appender"},Ht={key:0,class:"children"},Wt={key:1};function qt(e,t){for(let o=0;o<e.length;o++)e[o].isSelected=t,e[o].children&&qt(e[o].children,t)}const Xt={name:"TreeNode",props:{node:{type:Object,required:!0},selector:{type:Boolean,default:!0},index:{type:Number},focused:{type:Boolean,default:!1},childsFiled:{type:String,default:"childrens"}},data:()=>({expanded:{},childloaded:{},isLoading:!1,selectChangeEvent:(0,s.inject)("selectChangeEvent",null),clickNodeEvent:(0,s.inject)("clickNodeEvent",null)}),methods:{async toggleExpand(){this.node[this.childsFiled]&&0!==this.node[this.childsFiled].length&&(this.expanded[this.node.uid]=!this.expanded[this.node.uid],this.expanded[this.node.uid]&&!this.childloaded[this.node.uid]&&await this.loadChildren(),this.$emit("updateExpanded",this.node))},async loadChildren(){this.childloaded[this.node.uid]=!0},onChildSelectChange(e){},onCheckboxChange(e){e.isSelected=!e.isSelected,e[this.childsFiled]?.length&&qt(e[this.childsFiled],e.isSelected),this.selectChangeEvent(this.node),this.$emit("changeSelection",this.node)},selectNode(e){this.clickNodeEvent(this.node)}}},Jt={components:{TreeNode:(0,B.A)(Xt,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("TreeNode",!0);return(0,s.openBlock)(),(0,s.createElementBlock)("li",_t,[(0,s.createElementVNode)("div",Ft,[(0,s.createElementVNode)("span",{class:"collapser",onClick:t[0]||(t[0]=(...e)=>a.toggleExpand&&a.toggleExpand(...e))},[o.node[o.childsFiled]?.length?(0,s.renderSlot)(e.$slots,"icon",{key:0,node:o.node},(()=>[(0,s.createTextVNode)((0,s.toDisplayString)(l.expanded[o.node.uid]?"▼":"▶"),1)]),!0):(0,s.createCommentVNode)("v-if",!0)]),(0,s.createElementVNode)("span",zt,[o.selector?(0,s.renderSlot)(e.$slots,"checkbox",{key:0},(()=>[(0,s.createElementVNode)("input",{ref:"checkedInput",type:"checkbox",onChange:t[1]||(t[1]=e=>a.onCheckboxChange(o.node)),checked:o.node.isSelected},null,40,Ut)]),!0):(0,s.createCommentVNode)("v-if",!0)]),e.$slots.prepend?((0,s.openBlock)(),(0,s.createElementBlock)("span",Ot,[(0,s.renderSlot)(e.$slots,"prepend",{node:o.node},void 0,!0)])):(0,s.createCommentVNode)("v-if",!0),(0,s.createElementVNode)("span",{class:"labeler",title:o.node.uid,onClick:t[2]||(t[2]=(...e)=>a.selectNode&&a.selectNode(...e))},[(0,s.renderSlot)(e.$slots,"label",{node:o.node},(()=>[(0,s.createElementVNode)("span",null,(0,s.toDisplayString)(o.node.uid)+"|",1)]),!0)],8,Pt),e.$slots.append?((0,s.openBlock)(),(0,s.createElementBlock)("span",Rt,[(0,s.renderSlot)(e.$slots,"append",{node:o.node,index:o.index},void 0,!0)])):(0,s.createCommentVNode)("v-if",!0)]),l.expanded[o.node.uid]&&Array.isArray(o.node[o.childsFiled])&&o.node[o.childsFiled].length?((0,s.openBlock)(),(0,s.createElementBlock)("ul",Ht,[l.childloaded[o.node.uid]?((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,{key:0},(0,s.renderList)(o.node[o.childsFiled],(t=>((0,s.openBlock)(),(0,s.createBlock)(i,{onChangeSelection:a.onChildSelectChange,selector:o.selector,focused:t.focused,key:t.uid,node:t},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$slots,((t,o)=>({name:o,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,o,(0,s.mergeProps)({ref_for:!0},t),void 0,!0)]))})))]),1032,["onChangeSelection","selector","focused","node"])))),128)):((0,s.openBlock)(),(0,s.createElementBlock)("div",Wt," load... "))])):(0,s.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-261e9d42"]])},props:{tree:{type:Array,required:!0},selector:{type:Boolean,default:!0},focused:{type:Boolean,default:!1},childsFiled:{type:String,default:"children"}},setup(e,{slots:t,emit:o}){(0,s.provide)("clickNodeEvent",(e=>{o("clickNode",e)})),(0,s.provide)("selectChangeEvent",(e=>{o("changeSelect",e)}))},methods:{onUpdateExpanded(e){const t=this.findNodeByUid(this.tree,e.uid);t&&(t.expanded=e.expanded),this.$emit("updateExpanded",e)},findNodeByUid(e,t){for(let o of e){if(o.uid===t)return o;if(o.children){let e=this.findNodeByUid(o.children,t);if(e)return e}}return null}}},Yt=(0,B.A)(Jt,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("TreeNode");return(0,s.openBlock)(),(0,s.createElementBlock)("div",Lt,[(0,s.createElementVNode)("ul",jt,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.tree,((t,n)=>((0,s.openBlock)(),(0,s.createBlock)(i,{key:t.uid,selector:o.selector,node:t,index:n,focused:o.focused,childsFiled:o.childsFiled,onUpdateExpanded:a.onUpdateExpanded},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$slots,((t,o)=>({name:o,fn:(0,s.withCtx)((t=>[(0,s.renderSlot)(e.$slots,o,(0,s.mergeProps)({ref_for:!0},t),void 0,!0)]))})))]),1032,["selector","node","index","focused","childsFiled","onUpdateExpanded"])))),128))])])}],["__scopeId","data-v-4c9e3d2a"]]),Kt={name:"TreeAssets",props:{title:""},data:()=>({filtersView:!1,filterRect:{},focused:[],editform:!1,editedAsset:{},newAsset:!1,viewlib:!1,libButtons:{add:!0,save:!1}}),computed:{tree(){return this.$app.assets.assetsTree},assets(){return this.$app.assets},selected(){return this.$app.selection.selected}},methods:{onAddClick(){this.$refs.assetsLib.addNew(),this.libButtons.save=!0,this.libButtons.add=!1},onAssetChange(e){},onSaveClick(){this.assets.updateAsset(this.current)},openLib(){(0,s.reactive)({save:!1}),this.$app.modal.open({header:{value:"Ресурсы",handler:()=>{this.$app.modal.close(),this.viewlib=!1}},content:{},footer:{buttons:[]}}),this.viewlib=!0},onEdit(e,t){this.editedAsset[e]=t},editAsset(e){this.editedAsset=e?{...e,progress:0}:{uid:null,type:"gltf",name:"Новый ресурс",url:"https://",parameters:{},progress:0},this.$app.assets.editAsset(this.editedAsset)},onUpdateExpanded(e){},onNodeClick(e){this.$app.selection.select(e.isgroup?null:e)},onChangeSelection(){},remove(e){this.assets.removeAsset(e)}},components:{TreeView:Yt}},Gt=(0,B.A)(Kt,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("icon"),c=(0,s.resolveComponent)("TreeView"),r=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",It,[(0,s.createElementVNode)("div",Tt,[(0,s.createTextVNode)((0,s.toDisplayString)(o.title)+": ",1),(0,s.createElementVNode)("button",{class:"square",onClick:t[0]||(t[0]=e=>a.editAsset())},[(0,s.createVNode)(i,{value:"plus",size:"0.9em"})]),(0,s.createCommentVNode)(' <button class="square" @click="openLib()">\n        <icon value="books" size="0.9em"></icon>\n      </button> ')]),(0,s.createVNode)(c,{childsFiled:"children",tree:a.tree,onClickNode:a.onNodeClick,onChangeSelect:a.onChangeSelection,onUpdateExpanded:a.onUpdateExpanded},{append:(0,s.withCtx)((({node:e,index:t})=>[(0,s.createElementVNode)("div",Mt,[(0,s.createCommentVNode)(' <icon v-if="!node.isgroup" value="target" v-tooltip="\'Find\'" size="1em" @click="$emit(\'target\', node)"></icon> '),(0,s.createCommentVNode)(' <icon v-if="!node.isgroup" value="pencil" v-tooltip="\'Редактировать\'" size="1em" @click="editAsset(node)">\n          </icon> '),e.isgroup?(0,s.createCommentVNode)("v-if",!0):(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createBlock)(i,{key:0,value:"bin",size:"1em",onClick:t=>a.remove(e)},null,8,["onClick"])),[[r,"Удалить"]])])])),label:(0,s.withCtx)((({node:o})=>[(0,s.createCommentVNode)(' <div @click="onSelectedNode" :class="{ \'focusedtree\': selected === node }"  class="label"\n          v-tooltip="`${node.url || node.type}`"> {{ node.name || node.uid }}</div> '),(0,s.createElementVNode)("div",{onClick:t[1]||(t[1]=(...t)=>e.onSelectedNode&&e.onSelectedNode(...t)),class:(0,s.normalizeClass)([{focusedtree:a.selected===o},"label"])},(0,s.toDisplayString)(o.name||o.uid),3)])),_:1},8,["tree","onClickNode","onChangeSelect","onUpdateExpanded"])])}],["__scopeId","data-v-cfd9d79a"]]),Zt={class:"hierarhy-view"},Qt={class:"treeicon"},eo={class:"container"},to={class:"block"},oo={class:"content"},no={class:"sub-content"},lo={class:"subtitle"},so={class:"subtitle"},ao=["value"],io={props:{callback:{type:Function},value:{type:Object,default:()=>({name:"",type:"model",parent:null})}},methods:{checkType(){return this.value.parent||"block"===this.value.type?this.value.parent&&"block"===this.value.type?(this.$app.toasts.add({message:"Тип block можно добавить только в корневой список. Не выбирайте элемент при добавлении."}),void this.$emit("update:value",{...this.value,type:"model"})):void 0:(this.$app.toasts.add({message:"В корневой список можно добавить только block тип"}),void this.$emit("update:value",{...this.value,type:"block"}))}},computed:{el:{get(){return this.value||{name:"",type:""}},set(e){this.$emit("update:value",e)}},types(){return this.$app.elements.types}}},co=(0,B.A)(io,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",eo,[(0,s.createElementVNode)("div",to,[(0,s.createElementVNode)("div",oo,[(0,s.createElementVNode)("div",no,[(0,s.createElementVNode)("div",lo,[(0,s.withDirectives)((0,s.createElementVNode)("input",{type:"text",placeholder:"Name","onUpdate:modelValue":t[0]||(t[0]=e=>a.el.name=e)},null,512),[[s.vModelText,a.el.name]])]),(0,s.createElementVNode)("div",so,[(0,s.withDirectives)((0,s.createElementVNode)("select",{onChange:t[1]||(t[1]=(...e)=>a.checkType&&a.checkType(...e)),class:"typeslist","onUpdate:modelValue":t[2]||(t[2]=e=>a.el.type=e)},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(a.types,(e=>((0,s.openBlock)(),(0,s.createElementBlock)("option",{value:e},(0,s.toDisplayString)(e),9,ao)))),256))],544),[[s.vModelSelect,a.el.type]])])])])])])}],["__scopeId","data-v-37404c2f"]]),ro={class:"container"},po={props:{values:{type:Object,require:!0}}},mo=(0,B.A)(po,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",ro,[(0,s.createElementVNode)("div",null,(0,s.toDisplayString)(o.values.text),1)])}],["__scopeId","data-v-2cc2e0b7"]]),uo={name:"TreeElement",props:{title:""},mounted(){},data:()=>({filtersView:!1,filterRect:{},requestRemove:!1,removeData:{text:""},newElementData:{},addElementView:!1}),computed:{selected(){return this.$app.selection.selected},selection(){return this.$app.selection},tree(){return this.$app.elements.list}},methods:{isInSlide:e=>e.state?.isState,insertToSlide(e){e.state?this.$app.toasts.add({message:"Блок уже добавлен в выбраный слайд"}):this.$app.slides.addState(this.$app.slides.actived.uid,e.paths)},deleteElement(e){this.removeData.text=`Удалить ${e.name} (${e.uid}) ?`,this.$app.modal.open({header:{value:"Удалить элемент",handler:()=>{this.$app.modal.close(),this.requestRemove=!1}},content:{},footer:{buttons:[{label:"Удалить",class:"secondary",handler:async()=>{this.$app.modal.close(),this.requestRemove=!1,this.$app.elements.remove(e),this.$app.toasts.add({message:`Элемент ${e.name} удален`})}},{label:"Отмена",class:"primary",handler:async()=>{this.$app.modal.close(),this.requestRemove=!1}}]}}),this.requestRemove=!0},onUpdateExpanded(e){},onNodeClick(e){this.$app.selection.select(e)},onChangeSelection(){},addElement(){let e;this.newElementData.name="Новый элемент",this.newElementData.uid=`Element${Date.now()}`,this.selected?.isElement?(this.newElementData.type=this.selected?"model":"block",e=this.selected,this.newElementData.paths=[...this.selected.paths]):(this.newElementData.type="block",this.newElementData.paths=[],this.newElementData.children=[]),this.newElementData.paths.push(this.newElementData.uid),this.newElementData.path=this.newElementData.paths.join("."),this.newElementData.visible=!0,this.$app.modal.open({header:{value:`Добавить элемент ${this.selected?.isElement?"в "+this.selected.name||0:" в сцену"}`,handler:()=>{this.$app.modal.close(),this.addElementView=!1}},content:{},footer:{buttons:[{label:"Добавить",class:"secondary",handler:async()=>{this.$app.elements.create(this.newElementData,e),this.$app.modal.close(),this.addElementView=!1}},{label:"Отмена",class:"primary",handler:async()=>{this.$app.modal.close(),this.addElementView=!1}}]}}),this.addElementView=!0}},components:{TreeView:Yt,ConfirmModal:mo,ElementAdd:co}},ho=(0,B.A)(uo,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("icon"),c=(0,s.resolveComponent)("TreeView"),r=(0,s.resolveComponent)("ConfirmModal"),d=(0,s.resolveComponent)("ElementAdd"),p=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",Zt,[(0,s.createElementVNode)("div",null,[(0,s.createTextVNode)((0,s.toDisplayString)(o.title)+": ",1),(0,s.createElementVNode)("button",{onClick:t[0]||(t[0]=(...e)=>a.addElement&&a.addElement(...e))},[(0,s.createVNode)(i,{value:"plus",size:"0.75em"})])]),(0,s.createVNode)(c,{tree:a.tree,onClickNode:a.onNodeClick,onChangeSelect:a.onChangeSelection,childsFiled:"children",onUpdateExpanded:a.onUpdateExpanded},{append:(0,s.withCtx)((({node:e,index:t})=>[(0,s.createElementVNode)("div",Qt,[(0,s.createCommentVNode)(' <icon value="target" v-tooltip="\'Фокус\'" size="1em" @click="$emit(\'target\', node)"></icon>'),(0,s.createCommentVNode)(" <icon v-tooltip=\"'Видимость'\" :value=\"node.show ? 'eye' : 'eye-blocked'\" size=\"1em\"\n            @click=\"node.visible = !node.visible\" :color=\"node.visible ? '#8ec58e' : '#8ec58e80'\">\n          </icon> "),(0,s.createTextVNode)(" "+(0,s.toDisplayString)(e.visible)+" ",1),e.isBlock?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createBlock)(i,{key:0,value:"dice",size:"1em",onClick:t=>a.insertToSlide(e),color:a.isInSlide(e)?"#8ec58e":"#8ec58e80"},null,8,["onClick","color"])),[[p,"Добавить в слайд"]]):(0,s.createCommentVNode)("v-if",!0),(0,s.withDirectives)((0,s.createVNode)(i,{onClick:t=>a.deleteElement(e),value:"bin",size:"1em"},null,8,["onClick"]),[[p,"Удалить"]]),(0,s.createCommentVNode)(' <icon v-if="index === 0" size="100%" value="bin"></icon> ')])])),label:(0,s.withCtx)((({node:e})=>[(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)([{focusedtree:a.selected===e},"label"])},(0,s.toDisplayString)(e.name||e.uid),3)])),_:1},8,["tree","onClickNode","onChangeSelect","onUpdateExpanded"]),l.requestRemove?((0,s.openBlock)(),(0,s.createBlock)(s.Teleport,{key:0,to:".modal-content"},[(0,s.createVNode)(r,{values:l.removeData},null,8,["values"])])):(0,s.createCommentVNode)("v-if",!0),l.addElementView?((0,s.openBlock)(),(0,s.createBlock)(s.Teleport,{key:1,to:".modal-content"},[(0,s.createVNode)(d,{value:l.newElementData,"onUpdate:value":t[1]||(t[1]=e=>l.newElementData=e)},null,8,["value"])])):(0,s.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-32771746"]]),vo={class:"hierarhy-view"},yo={class:"treeicon"},ko={name:"Hierarhy",props:{title:""},data:()=>({filtersView:!1,filterRect:{}}),computed:{selected(){return this.$app.selection.selected},slide(){return this.$app.slides.actived||{children:[]}}},methods:{removeState(e){this.$app.slides.removeState(e.path,this.$app.slides.actived.uid)},onNodeClick(e){this.$app.selection.select(e)},onChangeSelection(){},onUpdateExpanded(){},assState(){"block"===this.$app.selection.element?.type||this.$app.toasts.add({message:"Только типы block можно добавлять в состояния"})}},components:{TreeView:Yt}},fo=(0,B.A)(ko,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("icon"),c=(0,s.resolveComponent)("TreeView"),r=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",vo,[(0,s.createElementVNode)("div",null,(0,s.toDisplayString)(o.title)+":"+(0,s.toDisplayString)(a.slide.name),1),(0,s.createVNode)(c,{tree:a.slide.children,onClickNode:a.onNodeClick,onChangeSelect:a.onChangeSelection,onUpdateExpanded:a.onUpdateExpanded},{checkbox:(0,s.withCtx)((()=>t[0]||(t[0]=[(0,s.createElementVNode)("span",null,[(0,s.createElementVNode)("input",{type:"checkbox"})],-1)]))),append:(0,s.withCtx)((({node:e,index:t})=>[(0,s.createCommentVNode)(' <div class="filters" v-if="index === 0">\n                    <button v-tooltip="\'Change filters\'"  @click="viewFilters" class="filterbutton">\n                        <icon v-for="v in target.filters" :value="v.props.value" :color="v.props.color" size="1em"></icon>\n                    </button>\n                    <PopupList v-if="filtersView" :rect="filterRect" :values="target.filters" @callback="filtersView = false"></PopupList>\n                </div> '),(0,s.createElementVNode)("div",yo,[(0,s.createCommentVNode)(' <icon value="target" v-tooltip="\'Fit\'" size="1em" @click="$emit(\'target\', node)"></icon>\n          <icon v-tooltip="\'Visible\'" :value="node.isVisible ? \'eye\' : \'eye-blocked\'" size="1em"\n            @click="$emit(\'visible\', node)">\n          </icon> '),(0,s.withDirectives)((0,s.createVNode)(i,{onClick:t=>a.removeState(e),value:"bin",size:"1em"},null,8,["onClick"]),[[r,"Удалить элемент из слайда"]])])])),label:(0,s.withCtx)((({node:e})=>[(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)([{focusedtree:a.selected===e},"label"])},(0,s.toDisplayString)(e.name||e.model.name||e.uid),3)])),_:1},8,["tree","onClickNode","onChangeSelect","onUpdateExpanded"])])}],["__scopeId","data-v-15bd43d8"]]),go={name:"UI",props:{element:null},data(){return{project:{blocks:[{component:"AssetsTree",data:{title:"Ресурсы"},onSelect:this.onSelectAsset},{component:"ElementsTree",data:{title:"Элементы"},onSelect:this.onSelectElement},{component:"StatesTree",data:{title:"Состояния"},onSelect:this.onSelectSlides}],header:{buttons:this.$app.app.header.buttons},footer:{buttons:this.$app.app.footer.buttons}},name:"",selectedSlide:null,selectedNodes:[]}},methods:{onButtonClick(e){e.handler&&e.handler()},onSelectAsset(e){},onSelectedNodesUpdate(){},camChange(e){const t=e.target.value,o=this.cameras.find((e=>e.uid===t));o&&"function"==typeof o.handler?o.handler():console.warn(`No handler found for camera with UID: ${t}`)},handleSlideSelected(e){this.selectedSlide=e,this.$emit("switchslide",e)},activateInMenu(e,t){if(!t)return this.menu.actived[e]=null,void("main"===e&&(this.menu.ext.length=0));this.menu.actived[e]=t.id,"main"===e&&(this.menu.ext.length=0,this.menu.ext.push(...t.ext||[]))}},computed:{slide(){return this.$app.slides.actived},selected(){return this.$app.selection.element},slides(){return this.$app.slides.list},cameras(){return this.$app.app.cameras},leftpanel(){return this.$app.app.leftpanel},rightpanel(){return this.$app.app.rightpanel},options(){return this.$app.options},menu(){return this.$app.menu},app(){return this.$app.app},tools:()=>toolse,models(){return this.$app.models},ready(){return this.$app.engine.ready},toasts(){return this.$app.toasts},modal(){return this.$app.modal},translations(){return this.$app.translations}},components:{ViewPanel:V,Sliders:A,HierarhyUI:j,InspectorUI:Dt,AssetsTree:Gt,ElementsTree:ho,StatesTree:fo}},bo=(0,B.A)(go,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("InspectorUI"),c=(0,s.resolveComponent)("icon"),r=(0,s.resolveComponent)("ViewPanel"),k=(0,s.resolveComponent)("Sliders"),f=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",d,[(0,s.createVNode)(i,{selected:a.selected,class:"inspector"},null,8,["selected"]),a.app.ready?((0,s.openBlock)(),(0,s.createBlock)(r,{key:0,class:"project",header:l.project.header,footer:l.project.footer},{header:(0,s.withCtx)((()=>[l.project.footer.buttons?((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,{key:0},(0,s.renderList)(l.project.header.buttons,(e=>(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{class:(0,s.normalizeClass)(e.class),onClick:t=>a.onButtonClick(e)},[e.label?((0,s.openBlock)(),(0,s.createElementBlock)("span",m,(0,s.toDisplayString)(e.label||"Close"),1)):(0,s.createCommentVNode)("v-if",!0),e.icon?((0,s.openBlock)(),(0,s.createBlock)(c,{key:1,value:e.icon,size:"1.5em"},null,8,["value"])):(0,s.createCommentVNode)("v-if",!0)],10,p)),[[f,e.tooltip]]))),256)):(0,s.createCommentVNode)("v-if",!0)])),footer:(0,s.withCtx)((()=>[l.project.footer.buttons?((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,{key:0},(0,s.renderList)(l.project.footer.buttons,(e=>(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{class:(0,s.normalizeClass)(e.class),onClick:t=>a.onButtonClick(e)},[e.label?((0,s.openBlock)(),(0,s.createElementBlock)("span",y,(0,s.toDisplayString)(e.label||"Close"),1)):(0,s.createCommentVNode)("v-if",!0),e.icon?((0,s.openBlock)(),(0,s.createBlock)(c,{key:1,value:e.icon,size:"1.5em"},null,8,["value"])):(0,s.createCommentVNode)("v-if",!0)],10,v)),[[f,e.tooltip]]))),256)):(0,s.createCommentVNode)("v-if",!0)])),default:(0,s.withCtx)((()=>[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(l.project.blocks,(e=>((0,s.openBlock)(),(0,s.createElementBlock)("div",u,[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(e.component||"div"),(0,s.mergeProps)({ref_for:!0},e.component?e.data:null,{onSelect:e.onSelect}),{default:(0,s.withCtx)((()=>[(0,s.createElementVNode)("div",{class:"content-value",innerHTML:e.value||""},null,8,h)])),_:2},1040,["onSelect"]))])))),256))])),_:1},8,["header","footer"])):(0,s.createCommentVNode)("v-if",!0),(0,s.createVNode)(k,{slides:a.slides,slide:a.slide,onSlideselect:a.handleSlideSelected,class:"sliders"},null,8,["slides","slide","onSlideselect"])])}],["__scopeId","data-v-3d408147"]]);var wo=o(64);const Eo=new Q.Raycaster,Bo=new class{constructor(){this._events={"*":[]}}subs(e,t,o){null==this._events[e]&&(this._events[e]=[]),this._events[e].push({handler:o,once:t})}on(e,t){this.subs(e,!1,t)}once(e,t){this.subs(e,!0,t)}off(e,t){const o=this._events[e];if(o){for(let e=o.length-1;e>=0;e--)o[e].handler===t&&o.splice(e,1);0===o.length&&delete this._events[e]}}clear(e){this._events[e]=[]}clearAll(){this._events={"*":[]}}emit(e,...t){const o=[];this._events[e]&&o.push(...this._events[e]),this._events["*"].length&&o.push(...this._events["*"].map((t=>({handler:t.handler.bind(this,e),once:t.once}))));for(let e=o.length-1;e>=0;e--){const n=o[e];n.handler.apply(null,t),n.once&&o.splice(e,1)}}addEventListener(e,t){this.on(e,t)}removeEventListener(e,t){this.off(e,t)}};let Vo,No,Co,So;const xo={x:0,y:0};let $o,Ao=.03,Do=.03,Io=.01,To=.01,Mo=window.innerWidth/2,Lo=window.innerHeight/2;function jo(e){for(;e;){if(e.isElement)return e;e=e.parent}return null}function _o(e){}function Fo(e){xo.x=e.clientX,xo.y=e.clientY,$o=Date.now()}function zo(e){if(Math.abs(xo.x-e.clientX)>10||Math.abs(xo.y-e.clientY)>10||Date.now()-$o>500)return;const t=new Q.Vector2,o=So.getBoundingClientRect(),n=e.clientX-o.left,l=e.clientY-o.top;t.x=n/So.clientWidth*2-1,t.y=-l/So.clientHeight*2+1,Eo.setFromCamera(t,No);const s=Eo.intersectObjects(Vo.children,!0);if(0!==s.length)for(let e=0;e<s.length;e++){const t=jo(s[e].object);if(t.visible)return void Bo.emit("click",t)}else Bo.emit("click",null)}const Uo=new Proxy(class{static get Control(){return Control}static Init(e,t,o,n,l){const s={camera:{range:{x:.01,y:.01},movespeed:{x:.03,y:.03}},...l};Vo=n,Co=o,No=t,So=e,Ao=s.camera.movespeed.x,Do=s.camera.movespeed.y,Io=s.camera.range.x,To=s.camera.range.y,Mo=window.innerWidth/2,Lo=window.innerHeight/2,e.addEventListener("click",zo.bind(null)),e.addEventListener("mousemove",_o,!1),e.addEventListener("mousedown",Fo,!1)}static Update(e){}static SetCamera(e){No=e}},{get:(e,t)=>t in e?e[t]:Bo[t]}),Oo=Uo,Po=wo.default||wo;let Ro,Ho,Wo,qo;function Xo(e){Ho.render(Ro,Wo)}const Jo=class{static async Init(e){qo=e;const{THREE:t,ProjectManager:o}=await Po.modules.load("engine","engine");Ro=o.Scene,Ho=new t.WebGLRenderer({canvas:e,alpha:!0,powerPreference:"high-performance",antialias:!0,stencil:!1});const n=qo.clientWidth,l=qo.clientHeight;Ho.setSize(n,l,!1),Ho.setPixelRatio(window.devicePixelRatio);const s=new t.CameraHelper(o.Camera);s.layers.set(1),Ro.add(s),Wo=new t.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.01,5e3),Wo.uid="EditorCamera",Ro.add(Wo),Wo.position.set(5,3,20),Ho.setAnimationLoop(Xo),Wo.layers.enable(1),ce.Init({canvas:qo},Wo,o.Scene),ce.FocusTo(o.Root),Oo.Init(qo,Wo,Ro,o.Root),Oo.on("click",(e=>{Po.selection.select(e)}))}},Yo={},Ko={data:()=>({selectedElement:null,elements:[]}),computed:{hierarhyAllow(){return this.$app.engine.instances.length>0},options(){return this.$app.options},app(){return this.$app.app},tools:()=>toolse,models(){return this.$app.models},ready(){return this.$app.engine.ready},toasts(){return this.$app.toasts},modal(){return this.$app.modal},translations(){return this.$app.translations}},methods:{onElementMount(e,t){Yo[t]&&(Yo[t](e),delete Yo[t])},addElement(e){return new Promise((t=>{this.elements.push({component:"UILabel",ref:e.path,data:{...e,visible:!1}}),Yo[e.path]=t}))},waitCanvasSize(e){const t=window.devicePixelRatio||1;e.forEach((e=>{e.width=e.clientWidth*t,e.height=e.clientHeight*t}))},slideSwitch(e){}},async mounted(){document.documentElement.setAttribute("data-theme","dark");const e=this.$refs.editorcanvas,t=this.$refs.playcanvas;this.waitCanvasSize([e,t]);const o=window.location.search,n=new URLSearchParams(o);window.THREE=Q,await this.$app.app.init(n.get("project")||"editor");const l=this.$app.engine.getManager();await l.Init(t),await l.Start(),await this.$app.app.load(),this.$app.engine.getManager("SlidesManager").GoTo(0),await Jo.Init(e),this.app.ready=!0},components:{UI:bo}},Go=(0,B.A)(Ko,[["render",function(e,t,o,n,l,d){const p=(0,s.resolveComponent)("UI"),m=(0,s.resolveComponent)("Modal"),u=(0,s.resolveComponent)("Toasts");return(0,s.openBlock)(),(0,s.createElementBlock)("div",a,[(0,s.createElementVNode)("canvas",i,null,512),(0,s.createElementVNode)("canvas",c,null,512),(0,s.createVNode)(p,{onSwitchslide:d.slideSwitch,element:l.selectedElement},null,8,["onSwitchslide","element"]),(0,s.createElementVNode)("div",r,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(l.elements,((e,t)=>((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(e.component),{onMounted:d.onElementMount,key:t,modelValue:e.data,"onUpdate:modelValue":t=>e.data=t},null,40,["onMounted","modelValue","onUpdate:modelValue"])))),128))],512),d.modal.isVisible?((0,s.openBlock)(),(0,s.createBlock)(m,{key:0})):(0,s.createCommentVNode)("v-if",!0),(0,s.createVNode)(u)])}]]),Zo={class:"overbutton"},Qo={class:"menulabel"},en={class:"btnicon"},tn={name:"ExpandedButton",props:{label:"",icon:"",color:"rgb(0,0,0)"}},on=(0,B.A)(tn,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("icon");return(0,s.openBlock)(),(0,s.createElementBlock)("button",Zo,[(0,s.createElementVNode)("div",Qo,(0,s.toDisplayString)(o.label),1),(0,s.createElementVNode)("div",en,[(0,s.createVNode)(i,{size:"100%",color:o.color,value:o.icon},null,8,["color","value"])])])}]]),nn=["fill","x","href"],ln=o.p+"assets/da739f090992f8b24ade.svg",sn={name:"Icon",props:{value:{type:String,default:()=>"icon-checkmark"},size:{type:String,default:()=>null},color:{type:String,default:()=>null},offset:{type:Number}},computed:{style(){return this.size?{width:`${this.size}`,height:`${this.size}`}:{width:"1em",height:"1em"}},val(){return`${ln}#p-${this.value.replace("p-","")}`}}},an=(0,B.A)(sn,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("svg",{preserveAspectRatio:"xMidYMid meet",class:"svgicon",style:(0,s.normalizeStyle)(a.style)},[(0,s.createElementVNode)("use",{class:"svguse",width:"100%",height:"100%",viewBox:"0 0 32 32",fill:o.color,x:o.offset,href:a.val},[(0,s.createElementVNode)("title",null,[(0,s.renderSlot)(e.$slots,"default",{},void 0,!0)])],8,nn)],4)}],["__scopeId","data-v-1165b5b0"]]),cn={class:"modal-header"},rn={class:"modal-content"},dn=["innerHTML"],pn={class:"modal-footer"},mn=["onClick"],un={computed:{modal(){return this.$app.modal},header(){return this.modal.header},content(){return this.modal.content},footer(){return this.modal.footer}},methods:{onSelf(){this.modal.values.closable&&this.modal.close()},onClick(e){"function"==typeof e&&e()},closeModal(e){"function"!=typeof e?this.modal.close():e()}}},hn=(0,B.A)(un,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",{class:"modal-overlay",onClick:t[3]||(t[3]=(0,s.withModifiers)(((...e)=>a.onSelf&&a.onSelf(...e)),["self"]))},[(0,s.createElementVNode)("div",{class:"modal",onClick:t[2]||(t[2]=(0,s.withModifiers)((()=>{}),["stop"]))},[(0,s.createElementVNode)("header",cn,[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(a.header.component||"div"),(0,s.mergeProps)({class:"header"},a.header.component?a.header:null),{default:(0,s.withCtx)((()=>[(0,s.createElementVNode)("h3",null,(0,s.toDisplayString)(a.header.value),1),(0,s.createElementVNode)("button",{class:"close-btn",onClick:t[0]||(t[0]=e=>a.closeModal(a.header.handler))},"×")])),_:1},16))]),(0,s.createElementVNode)("main",rn,[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(a.content.component||"div"),(0,s.mergeProps)({class:"content"},a.content.component?a.content.props:null,(0,s.toHandlers)(a.content.events||{})),(0,s.createSlots)({default:(0,s.withCtx)((()=>[(0,s.createElementVNode)("div",{class:"content-value",innerHTML:a.content.value||""},null,8,dn)])),_:2},[(0,s.renderList)(a.content.slots,((e,t)=>({name:t,fn:(0,s.withCtx)((t=>[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(e.component),(0,s.mergeProps)(t,(0,s.toHandlers)(e.events||{})),null,16))]))})))]),1040))]),(0,s.createElementVNode)("footer",pn,[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(a.footer.component||"div"),(0,s.mergeProps)({class:"footer"},a.footer.component?a.footer.props:null,{onClose:a.closeModal}),{default:(0,s.withCtx)((()=>[a.footer.buttons?((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,{key:0},(0,s.renderList)(a.footer.buttons,(e=>((0,s.openBlock)(),(0,s.createElementBlock)("button",{class:(0,s.normalizeClass)(e.class),onClick:t=>a.onClick(e.handler)},(0,s.toDisplayString)(e.label||"Close"),11,mn)))),256)):((0,s.openBlock)(),(0,s.createElementBlock)("button",{key:1,class:(0,s.normalizeClass)(a.footer.class),onClick:t[1]||(t[1]=e=>a.closeModal(a.footer.handler))},(0,s.toDisplayString)(a.footer.label||"Close"),3))])),_:1},16,["onClose"]))])])])}],["__scopeId","data-v-7f5c7346"]]),vn=["onClick"],yn={props:{values:{type:Array},rect:{type:Object},size:{type:Object,default:{width:200,height:100}}},data:()=>({popupStyle:{}}),methods:{togglePopup(e){const t=window.innerWidth;let o=this.rect.top+window.scrollY,n=this.rect.left+window.scrollX;n+this.size.width>t&&(n=this.rect.right-this.size.width+window.scrollX),this.popupStyle={position:"absolute",top:`${o}px`,left:`${n}px`,width:`${this.size.width}px`},this.isPopupVisible=!0},hidePopup(){this.$emit("callback")}}},kn=(0,B.A)(yn,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",{class:"popup",style:(0,s.normalizeStyle)(l.popupStyle)},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.values,((t,o)=>(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("p",{class:"element",key:o,onClick:o=>t.handler?t.handler(t):e.$emit("click",t)},[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(t.component||"div"),(0,s.mergeProps)({ref_for:!0},t.props),{default:(0,s.withCtx)((()=>[(0,s.createTextVNode)((0,s.toDisplayString)(t.props),1)])),_:2},1040))],8,vn)),[[i,t.tooltip]]))),128)),(0,s.createElementVNode)("button",{onClick:t[0]||(t[0]=(...e)=>a.hidePopup&&a.hidePopup(...e))},"ОК")],4)}],["__scopeId","data-v-1591e2fe"]]),fn={key:0,class:"menulabel"},gn={key:1,class:"btnicon"},bn={name:"SimpleButton",props:{label:{type:String},icon:{type:Object},tooltip:{type:String},handlers:{type:Object,required:!0}},methods:{onClick(){this.handlers?.click?this.handlers.click(this):this.$emit("click",this)}}},wn=(0,B.A)(bn,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("icon"),c=(0,s.resolveDirective)("tooltip");return(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{class:"small-btn simple",onClick:t[0]||(t[0]=(...e)=>a.onClick&&a.onClick(...e))},[o.label?((0,s.openBlock)(),(0,s.createElementBlock)("div",fn,(0,s.toDisplayString)(o.label),1)):(0,s.createCommentVNode)("v-if",!0),o.icon?((0,s.openBlock)(),(0,s.createElementBlock)("div",gn,[(0,s.createVNode)(i,{size:o.icon.size||"100%",value:o.icon.value},null,8,["size","value"])])):(0,s.createCommentVNode)("v-if",!0)])),[[c,o.tooltip]])}],["__scopeId","data-v-7f0518be"]]),En={key:0,class:"menulabel"},Bn={key:1,class:"btnicon"},Vn={name:"ToggleButton",props:{id:{type:String,required:!0},label:{type:String},icon:{type:Object},group:{type:Object},handlers:{type:Object,required:!0},tooltip:{type:String}},computed:{isActive(){return this.group.activeId===this.id}},mounted(){this.handlers.activate&&this.handlers.activate(this)},beforeUnmount(){this.handlers.deactivate&&this.handlers.deactivate(this)},methods:{onClick(){this.handlers.click?this.handlers.click(this):this.$emit("click",this)}}},Nn=(0,B.A)(Vn,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("icon"),c=(0,s.resolveDirective)("tooltip");return(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{class:(0,s.normalizeClass)(["small-btn simple",{active:a.isActive}]),onClick:t[0]||(t[0]=(...e)=>a.onClick&&a.onClick(...e))},[o.label?((0,s.openBlock)(),(0,s.createElementBlock)("div",En,(0,s.toDisplayString)(o.label),1)):(0,s.createCommentVNode)("v-if",!0),o.icon?((0,s.openBlock)(),(0,s.createElementBlock)("div",Bn,[(0,s.createVNode)(i,{size:o.icon.size||"100%",value:o.icon.value},null,8,["size","value"])])):(0,s.createCommentVNode)("v-if",!0)],2)),[[c,o.tooltip]])}],["__scopeId","data-v-673fd16a"]]),Cn={class:"spinner"},Sn={name:"Spinner"},xn=(0,B.A)(Sn,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Cn)}],["__scopeId","data-v-4736cf19"]]),$n={class:"toast-container"},An={computed:{list(){return this.$app.toasts.list}},methods:{onClick(e){e.onclick&&e.onclick()}}},Dn=(0,B.A)(An,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",$n,[(0,s.createVNode)(s.TransitionGroup,{name:"toast",tag:"div"},{default:(0,s.withCtx)((()=>[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(a.list,(t=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:t.id,class:"toast"},[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(t.component||"div"),(0,s.mergeProps)({class:"toastview",ref_for:!0},t.data,{onClick:e=>a.onClick(t)}),{default:(0,s.withCtx)((()=>[t.component?(0,s.createCommentVNode)("v-if",!0):(0,s.renderSlot)(e.$slots,"default",{key:0},(()=>[(0,s.createTextVNode)((0,s.toDisplayString)(t.data.message),1)]),!0)])),_:2},1040,["onClick"]))])))),128))])),_:3})])}],["__scopeId","data-v-3aed840a"]]),In={class:"alert"},Tn={class:"text"},Mn={name:"Label",props:{icon:{type:String,default:"notification"},message:{type:String,default:""},type:{type:String,default:"info"}}},Ln=(0,B.A)(Mn,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("icon");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createElementVNode)("div",In,[(0,s.createVNode)(i,{class:(0,s.normalizeClass)(`${o.type}icon`),size:"3em",value:o.icon},null,8,["class","value"]),(0,s.createElementVNode)("span",Tn,(0,s.toDisplayString)(o.message),1)])])}]]),jn={class:"slide-scroller",ref:"scroller"},_n=["onClick"],Fn=["src"],zn={class:"title"},Un={props:{slides:{type:Array,required:!0}},data:()=>({selectedIndex:0,translateX:0}),mounted(){this.centerSelectedImage()},watch:{selectedIndex(){this.centerSelectedImage()}},methods:{addSlide(){this.$emit("addslide")},selectImage(e){this.selectedIndex=e,this.$emit("slideselect",this.slides[e].uid)},centerSelectedImage(){this.$nextTick((()=>{const e=this.$refs.scroller.offsetWidth,t=this.$refs.scroller.querySelector(".slide-item.selected");if(t){const o=t.offsetWidth,n=t.offsetLeft;this.translateX=-(n-e/2+o/2)}}))}}},On=(0,B.A)(Un,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",jn,[(0,s.createElementVNode)("div",{class:"slide-container",style:(0,s.normalizeStyle)({transform:`translateX(${l.translateX}px)`})},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.slides,((e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:t,class:(0,s.normalizeClass)(["slide-item",{selected:l.selectedIndex===t}]),onClick:e=>a.selectImage(t)},[(0,s.createElementVNode)("img",{src:e.preview,alt:"Image"},null,8,Fn),(0,s.createElementVNode)("div",zn,(0,s.toDisplayString)(e.uid),1)],10,_n)))),128)),(0,s.createElementVNode)("div",{class:"slide-item",onClick:t[0]||(t[0]=e=>a.addSlide())},t[1]||(t[1]=[(0,s.createElementVNode)("img",{src:"cardbg",alt:"Image"},null,-1)]))],4)],512)}],["__scopeId","data-v-dafd9036"]]),Pn={class:"menu-container"},Rn={key:0,class:"menublock"},Hn={name:"ExtMenu",props:{list:{type:Array,default:[]},actived:{type:String}},computed:{menu(){return this.$app.menu}},methods:{onClick(e){const t=this.list.find((e=>e.id===this.actived));t&&(t.handlers?.disable?.(),t===e)?this.$emit("activate",null):(e.handler?.(e)||e.handlers?.enable?.(e)||this.$emit("click",e),this.$emit("activate",e))}}},Wn=(0,B.A)(Hn,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("ExpandedButton");return(0,s.openBlock)(),(0,s.createElementBlock)("div",Pn,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.list,((e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:t,class:(0,s.normalizeClass)([e.class,"menu-item"])},[e.hidden?(0,s.createCommentVNode)("v-if",!0):((0,s.openBlock)(),(0,s.createElementBlock)("div",Rn,[(0,s.createVNode)(i,{onClick:(0,s.withModifiers)((t=>a.onClick(e)),["stop"]),label:e.label,color:e.id&&o.actived===e.id?"#ffff00":null,icon:e.icon},null,8,["onClick","label","color","icon"])]))],2)))),128))])}]]),qn={class:"input-wrapper"},Xn=["type","value","placeholder"],Jn={name:"MinimalInput",props:{type:{type:String,default:"text"},value:{type:[String,Number],default:""},placeholder:{type:String,default:""}},emits:["update:value"]},Yn=(0,B.A)(Jn,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",qn,[(0,s.createElementVNode)("input",{type:o.type,value:o.value,onInput:t[0]||(t[0]=t=>e.$emit("update:value",t.target.value)),placeholder:o.placeholder,class:"input-field"},null,40,Xn)])}],["__scopeId","data-v-2c548edc"]]),Kn={class:"container"},Gn={class:"label"},Zn={class:"value"},Qn=["onUpdate:modelValue"],el={props:{values:{type:Object,require:!0}},emits:["update:values"],computed:{}},tl=(0,B.A)(el,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Kn,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.values,((e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:t,class:"block"},[(0,s.createElementVNode)("div",Gn,(0,s.toDisplayString)(e.label),1),(0,s.createElementVNode)("div",Zn,[(0,s.withDirectives)((0,s.createElementVNode)("input",{"onUpdate:modelValue":t=>e.value=t},null,8,Qn),[[s.vModelText,e.value]])])])))),128))])}],["__scopeId","data-v-2b60153b"]]),ol={name:"SliderBlock",props:{value:{type:Boolean,default:()=>!1},property:{type:String,default:"top"},shift:{type:Number,default:100},zero:{type:Number,default:0}},computed:{style(){return{[this.property]:this.value?`${this.shift}px`:`${this.zero}px`}}},mounted(){"right"===this.property||"left"===this.property?this.$el.style.width=this.shift-this.zero+"px":this.$el.style.height=this.shift-this.zero+"px"}},nl=(0,B.A)(ol,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",{class:"slider",style:(0,s.normalizeStyle)(a.style)},[(0,s.renderSlot)(e.$slots,"default",{},void 0,!0),(0,s.createElementVNode)("div",{onClick:t[0]||(t[0]=t=>e.$emit("revert"))},[(0,s.renderSlot)(e.$slots,"button",{},void 0,!0)])],4)}],["__scopeId","data-v-b3fc2cec"]]),ll={key:0},sl={key:1},al={key:2,class:"child-list"},il={key:0},cl={name:"TreeLi",props:["value"],data:()=>({childshow:!1})},rl=(0,B.A)(cl,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("TreeLi",!0);return(0,s.openBlock)(),(0,s.createElementBlock)("li",null,[o.value.children?(0,s.createCommentVNode)("v-if",!0):((0,s.openBlock)(),(0,s.createElementBlock)("div",ll,t[1]||(t[1]=[(0,s.createElementVNode)("svg",{class:"edicon ics-spinner10"},[(0,s.createElementVNode)("use",{"xlink:href":"#ics-spinner10"})],-1)]))),o.value.children?((0,s.openBlock)(),(0,s.createElementBlock)("div",al,[(0,s.createElementVNode)("span",{onClick:t[0]||(t[0]=t=>e.childshow=!e.childshow)},[t[3]||(t[3]=(0,s.createElementVNode)("input",{type:"checkbox"},null,-1)),(0,s.createTextVNode)((0,s.toDisplayString)(o.value.name),1)]),e.childshow?((0,s.openBlock)(),(0,s.createElementBlock)("ul",il,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.value.children,((e,t)=>((0,s.openBlock)(),(0,s.createBlock)(i,{key:t,value:e},null,8,["value"])))),128))])):(0,s.createCommentVNode)("v-if",!0)])):((0,s.openBlock)(),(0,s.createElementBlock)("span",sl,[t[2]||(t[2]=(0,s.createElementVNode)("input",{type:"checkbox"},null,-1)),(0,s.createTextVNode)((0,s.toDisplayString)(o.value.name),1)]))])}],["__scopeId","data-v-562df7a6"]]),dl={class:"selectable-container"},pl={class:"list"},ml={class:"grid"},ul=["onClick"],hl={key:0,class:"info"},vl={name:"ActionsLib",data:()=>({current:null}),props:{list:{type:Array},selected:{type:Object}},watch:{selected(e,t){this.current=e}},emits:["selectItem"],methods:{onItemSelect(e){this.$emit("selectItem",e)}}},yl=(0,B.A)(vl,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",dl,[(0,s.createElementVNode)("div",pl,[(0,s.createElementVNode)("div",ml,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.list,((t,o)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{onClick:e=>a.onItemSelect(t),class:"grid-element",key:o},[(0,s.renderSlot)(e.$slots,"item",{item:t})],8,ul)))),128))])]),l.current?((0,s.openBlock)(),(0,s.createElementBlock)("div",hl,[(0,s.renderSlot)(e.$slots,"selected",{item:l.current})])):(0,s.createCommentVNode)("v-if",!0)])}]]),kl={class:"vlist-container"},fl={class:"list"},gl={class:"vlist"},bl=["onClick"],wl={name:"ActionsLib",data:()=>({current:null}),props:{list:{type:Array},selected:{type:Object}},watch:{selected(e,t){this.current=e}},emits:["selectItem"],methods:{onItemSelect(e){this.$emit("selectItem",e)}}},El=(0,B.A)(wl,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",kl,[(0,s.createElementVNode)("div",fl,[(0,s.createElementVNode)("div",gl,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.list,((t,o)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{onClick:e=>a.onItemSelect(t),class:"vlist-element",key:o},[(0,s.renderSlot)(e.$slots,"item",{item:t})],8,bl)))),128))])])])}]]),Bl={style:{display:"flex","justify-content":"space-between"}},Vl={name:"BoolEdit",props:["value","label","selected"],computed:{val:{get(){return this.value},set(e){this.$emit("update:value",e)}}}},Nl=(0,B.A)(Vl,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Bl,[(0,s.createElementVNode)("div",null,(0,s.toDisplayString)(o.label),1),(0,s.createElementVNode)("div",null,[(0,s.withDirectives)((0,s.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=e=>a.val=e)},null,512),[[s.vModelCheckbox,a.val]])])])}]]),Cl={class:"input-float"},Sl=["value","step"],xl={name:"input-float",props:["value","step","label"],methods:{onWheel(){},onChange(){}}},$l=(0,B.A)(xl,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Cl,[(0,s.createElementVNode)("span",null,(0,s.toDisplayString)(o.label),1),(0,s.createElementVNode)("div",null,[(0,s.createElementVNode)("input",{value:o.value,type:"number",step:o.step,onInput:t[0]||(t[0]=t=>e.$emit("update:value",parseFloat(t.target.value)))},null,40,Sl)]),(0,s.createCommentVNode)('<input s  \r\n    v-bind:value="value"\r\n    type="number"\r\n    :step="step"\r\n    @mousewheel="onWheel"\r\n    @input="$emit(\'input\', parseFloat($event.target.value) || value)"\r\n  />')])}]]),Al=["onUpdate:modelValue"],Dl=["onUpdate:modelValue"],Il={name:"NameEditor",data:()=>({properties:[{property:"envMap",value:null}]}),methods:{updateAsset(){for(let e=0;e<this.properties.length;e++){const t=this.properties[e];this.selected[t.property],this.$app.assets.updateAsset(this.selected,t.property,(()=>{}))}}},props:{selected:{type:Object}}},Tl=(0,B.A)(Il,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(l.properties,(e=>((0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.withDirectives)((0,s.createElementVNode)("input",{"onUpdate:modelValue":t=>e.property=t},null,8,Al),[[s.vModelText,e.property]]),(0,s.withDirectives)((0,s.createElementVNode)("input",{"onUpdate:modelValue":t=>o.selected[e.property]=t},null,8,Dl),[[s.vModelText,o.selected[e.property]]])])))),256)),(0,s.createElementVNode)("div",null,[(0,s.createElementVNode)("button",{class:"btn",onClick:t[0]||(t[0]=(...e)=>a.updateAsset&&a.updateAsset(...e))},"Update")])])}]]),Ml={class:"comma-number-input-wrapper"},Ll={class:"arrow-buttons"},jl={name:"CommaNumberInput",props:{value:Number,step:{type:Number,default:1},min:{type:Number,default:Number.MIN_SAFE_INTEGER},max:{type:Number,default:Number.MAX_SAFE_INTEGER},decimals:{type:Number,default:2}},data:()=>({interval:null,separator:",",isPressed:!1,changeSpeed:100}),computed:{formattedValue:{get(){return this.value||0},set(e){this.$emit("changed",this.parseNumber(e))}}},mounted(){const e=(new Intl.NumberFormat).format(this.value);this.separator=e.charAt(1),this.$refs.input.addEventListener("wheel",this.onWheel,{passive:!1})},beforeDestroy(){this.$refs.input.removeEventListener("wheel",this.onWheel)},methods:{onFocus(){this.$nextTick((()=>{this.$refs.input.select()}))},parseNumber:e=>parseFloat(e.replace(",","."))||0,formatNumber(e){return parseFloat(e).toFixed(this.decimals).replace(".",",")},onInput(e){this.$emit("changed",this.parseNumber(e.target.value))},onWheel(e){e.preventDefault(),e.stopPropagation(),document.activeElement===this.$refs.input&&this.changeValue(e.deltaY>0?-this.step:this.step)},onKeyDown(e){"ArrowUp"===e.key?(this.changeValue(this.step),e.preventDefault()):"ArrowDown"===e.key&&(this.changeValue(-this.step),e.preventDefault())},changeValue(e){let t=(this.value||0)+e;t=Math.max(Math.min(t,this.max),this.min),this.$emit("changed",parseFloat(t.toFixed(this.decimals)))},startIncrement(){this.interval&&clearInterval(this.interval),this.isPressed=!0,this.changeValue(this.step),setTimeout((()=>{this.isPressed&&(this.interval=setInterval((()=>this.changeValue(this.step)),50))}),400)},startDecrement(){this.interval&&clearInterval(this.interval),this.isPressed=!0,this.changeValue(-this.step),setTimeout((()=>{this.isPressed&&(this.interval=setInterval((()=>this.changeValue(-this.step)),50))}),400)},stopChange(){this.isPressed=!1,clearInterval(this.interval)}}},_l=(0,B.A)(jl,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Ml,[(0,s.withDirectives)((0,s.createElementVNode)("input",{ref:"input",type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>a.formattedValue=e),onKeydown:t[1]||(t[1]=(...e)=>a.onKeyDown&&a.onKeyDown(...e)),onDblclick:t[2]||(t[2]=(...e)=>a.onFocus&&a.onFocus(...e)),class:"comma-number-input"},null,544),[[s.vModelText,a.formattedValue]]),(0,s.createElementVNode)("div",Ll,[(0,s.createElementVNode)("button",{onMousedown:t[3]||(t[3]=(...e)=>a.startIncrement&&a.startIncrement(...e)),onMouseup:t[4]||(t[4]=(...e)=>a.stopChange&&a.stopChange(...e)),onMouseleave:t[5]||(t[5]=(...e)=>a.stopChange&&a.stopChange(...e))},"▲",32),(0,s.createElementVNode)("button",{onMousedown:t[6]||(t[6]=(...e)=>a.startDecrement&&a.startDecrement(...e)),onMouseup:t[7]||(t[7]=(...e)=>a.stopChange&&a.stopChange(...e)),onMouseleave:t[8]||(t[8]=(...e)=>a.stopChange&&a.stopChange(...e))},"▼",32)])])}]]),Fl={style:{display:"grid","grid-template-columns":"96px 1fr"}},zl={style:{"text-align":"center"}},Ul={props:{selected:{type:Object},values:{type:Object,default:{property:"intensity ",step:.01}},label:{type:String}},watch:{selected(){this.val=this.$app.project.readElementProp(this.selected.uid,this.values.property)}},data:()=>({val:0}),mounted(){this.val=this.$app.project.readElementProp(this.selected.uid,this.values.property)},methods:{updateValue(e){this.selected.properties||(this.selected.properties={}),this.selected.properties[this.values.property]||(this.selected.properties[this.values.property]=1),this.selected.properties[this.values.property]=e,this.$app.project.updateElementProps(this.selected.uid,{[this.values.property]:e}),this.val=this.$app.project.readElementProp(this.selected.uid,this.values.property)}}},Ol=(0,B.A)(Ul,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("FloatInput");return(0,s.openBlock)(),(0,s.createElementBlock)("div",Fl,[(0,s.createElementVNode)("div",null,(0,s.toDisplayString)(o.label),1),(0,s.createElementVNode)("div",zl,[(0,s.createVNode)(i,{min:o.values.min||0,step:o.values.step||.01,value:l.val,onChanged:a.updateValue},null,8,["min","step","value","onChanged"])])])}]]),Pl={style:{display:"flex",gap:"7px"}},Rl={style:{display:"flex",gap:"3px"}},Hl={style:{display:"flex",gap:"3px"}},Wl={style:{display:"flex",gap:"3px"}},ql={props:{values:{type:Object,default:new Q.Vector3},decimals:{type:Number,default:4},step:{type:Number,default:1}},methods:{updateValue(e,t){"number"==typeof t&&(this.values[e]=t,this.$emit("update:values",this.values))}}},Xl=(0,B.A)(ql,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("FloatInput");return(0,s.openBlock)(),(0,s.createElementBlock)("div",Pl,[(0,s.createElementVNode)("div",Rl,[t[3]||(t[3]=(0,s.createElementVNode)("label",{style:{"font-size":"1.2em"}},"x",-1)),(0,s.createVNode)(i,{value:o.values.x,decimals:o.decimals,step:o.step,onChanged:t[0]||(t[0]=e=>a.updateValue("x",e))},null,8,["value","decimals","step"])]),(0,s.createElementVNode)("div",Hl,[t[4]||(t[4]=(0,s.createElementVNode)("label",{style:{"font-size":"1.2em"}},"y",-1)),(0,s.createVNode)(i,{value:o.values.y,decimals:o.decimals,step:o.step,onChanged:t[1]||(t[1]=e=>a.updateValue("y",e))},null,8,["value","decimals","step"])]),(0,s.createElementVNode)("div",Wl,[t[5]||(t[5]=(0,s.createElementVNode)("label",{style:{"font-size":"1.2em"}},"z",-1)),(0,s.createVNode)(i,{value:o.values.z,decimals:o.decimals,step:o.step,onChanged:t[2]||(t[2]=e=>a.updateValue("z",e))},null,8,["value","decimals","step"])])])}]]),Jl={style:{display:"flex","align-items":"center",gap:"1px","flex-direction":"column"}},Yl={key:0,class:"tools"},Kl={key:1,class:"titleinfo"},Gl={data:()=>({expanded:!0}),props:{label:String,values:{type:Object,default:new Q.Vector3},decimals:{type:Number,default:2},step:{type:Number,default:1}},watch:{values(e,t){}}},Zl=(0,B.A)(Gl,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("V3");return(0,s.openBlock)(),(0,s.createElementBlock)("div",Jl,[(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["title",l.expanded?"":"min"])},[(0,s.createElementVNode)("div",{class:"label",onClick:t[0]||(t[0]=e=>l.expanded=!l.expanded)},(0,s.toDisplayString)(l.expanded?"▼":"▶")+" "+(0,s.toDisplayString)(o.label),1),l.expanded?((0,s.openBlock)(),(0,s.createElementBlock)("div",Yl,[(0,s.renderSlot)(e.$slots,"tools",{},void 0,!0)])):((0,s.openBlock)(),(0,s.createElementBlock)("div",Kl,"x:"+(0,s.toDisplayString)(o.values.x.toFixed(o.decimals))+",y:"+(0,s.toDisplayString)(o.values.y.toFixed(o.decimals))+",z:"+(0,s.toDisplayString)(o.values.z.toFixed(o.decimals)),1))],2),l.expanded?((0,s.openBlock)(),(0,s.createBlock)(i,{key:0,values:o.values,decimals:o.decimals,step:o.step,"onUpdate:values":t[1]||(t[1]=t=>e.$emit("update:values",t))},null,8,["values","decimals","step"])):(0,s.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-043ee8ac"]]),Ql={style:{display:"flex","align-items":"center",gap:"3px","flex-direction":"column"}},es={class:"label"},ts={key:0,class:"tools"},os={key:1,class:"titleinfo"},ns={data:()=>({expanded:!0}),props:{quaternion:Object,label:String,values:Object,decimals:{type:Number,default:2},step:{type:Number,default:1}},methods:{onChangeVal(e){e.x>359&&(e.x=0),e.x<-359&&(e.x=0),e.y>359&&(e.y=0),e.y<-359&&(e.y=0),e.z>359&&(e.z=0),e.z<-359&&(e.z=0),this.$emit("update:values",{x:ne(Math.round(e.x)),y:ne(Math.round(e.y)),z:ne(Math.round(e.z))})}},mounted(){},computed:{formattedValue:{get(){return{x:Math.round(oe(this.values.x)),y:Math.round(oe(this.values.y)),z:Math.round(oe(this.values.z))}},set(e){this.$emit("update:values",{x:ne(Math.round(e.x)),y:ne(Math.round(e.y)),z:ne(Math.round(e.z))})}}}},ls=(0,B.A)(ns,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("V3");return(0,s.openBlock)(),(0,s.createElementBlock)("div",Ql,[(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["title",l.expanded?"":"min"]),onClick:t[0]||(t[0]=e=>l.expanded=!l.expanded)},[(0,s.createElementVNode)("div",es,(0,s.toDisplayString)(l.expanded?"▼":"▶")+" "+(0,s.toDisplayString)(o.label),1),l.expanded?((0,s.openBlock)(),(0,s.createElementBlock)("div",ts,[(0,s.renderSlot)(e.$slots,"tools",{},void 0,!0)])):((0,s.openBlock)(),(0,s.createElementBlock)("div",os,"x:"+(0,s.toDisplayString)(a.formattedValue.x)+",y:"+(0,s.toDisplayString)(a.formattedValue.y)+",z:"+(0,s.toDisplayString)(a.formattedValue.z),1))],2),l.expanded?((0,s.openBlock)(),(0,s.createBlock)(i,{key:0,values:a.formattedValue,decimals:o.decimals,step:o.step,"onUpdate:values":a.onChangeVal},null,8,["values","decimals","step","onUpdate:values"])):(0,s.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-4c8a5658"]]),ss={class:"block_container"},as={key:0,class:"editrow"},is={class:"label"},cs={name:"LabelEditor",props:["value","editable","label","tooltip"],data:()=>({editMode:!1,val:""}),watch:{value(){this.editMode=!1}},methods:{endEdit(){return this.editMode?(this.editMode=!1,this.val):this.value}}},rs=(0,B.A)(cs,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("icon"),c=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createElementVNode)("div",ss,[(0,s.createElementVNode)("div",null,(0,s.toDisplayString)(o.label),1),e.editMode?((0,s.openBlock)(),(0,s.createElementBlock)("div",as,[(0,s.withDirectives)((0,s.createElementVNode)("input",{class:"editinput","onUpdate:modelValue":t[0]||(t[0]=t=>e.val=t)},null,512),[[s.vModelText,e.val]]),(0,s.createVNode)(i,{class:"okicon",value:"checkmark",size:"1em",onClick:t[1]||(t[1]=t=>{e.$emit("update:value",e.val),e.editMode=!1})})])):(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",{class:"editrow",onClick:t[2]||(t[2]=t=>{e.val=o.value,e.editMode=!0}),key:"tooltip-"+o.value},[(0,s.createElementVNode)("span",is,(0,s.toDisplayString)(o.value),1),(0,s.createVNode)(i,{value:"pencil",size:"1em"})])),[[c,o.tooltip||o.value]])])])}],["__scopeId","data-v-08a6e69f"]]),ds={style:{display:"grid","grid-template-columns":"96px 1fr"}},ps={style:{"text-align":"center"}},ms={name:"EditColor",props:{selected:{type:Object},label:{type:String},values:{type:Object,default:{property:"color"}}},watch:{selected(){this.val=`#${this.$app.project.readElementProp(this.selected.uid,this.values.property).getHexString()}`}},data:()=>({val:"#ffff00"}),mounted(){this.val=`#${this.$app.project.readElementProp(this.selected.uid,this.values.property).getHexString()}`},methods:{updateColor(e){this.selected.properties||(this.selected.properties={}),this.selected.properties[this.values.property]||(this.selected.properties[this.values.property]={type:"Color",args:[e.target.value]}),this.selected.properties[this.values.property]={type:"Color",args:[e.target.value]},this.$app.project.updateElementProps(this.selected.uid,{color:{type:"Color",args:[e.target.value]}}),this.val=`#${this.$app.project.readElementProp(this.selected.uid,this.values.property).getHexString()}`}}},us=(0,B.A)(ms,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",ds,[(0,s.createElementVNode)("div",null,(0,s.toDisplayString)(o.label),1),(0,s.createElementVNode)("div",ps,[(0,s.withDirectives)((0,s.createElementVNode)("input",{style:{width:"100%"},ref:"col",type:"color",id:"colorPicker","onUpdate:modelValue":t[0]||(t[0]=e=>l.val=e),onInput:t[1]||(t[1]=(...e)=>a.updateColor&&a.updateColor(...e))},null,544),[[s.vModelText,l.val]])])])}]]),hs={style:{display:"grid","grid-template-columns":"96px 1fr"}},vs={name:"Label",props:{label:{type:String},selected:{type:Object}}},ys=(0,B.A)(vs,[["render",function(e,t,o,n,l,a){return(0,s.openBlock)(),(0,s.createElementBlock)("div",hs,[(0,s.createElementVNode)("div",null,(0,s.toDisplayString)(o.label),1),(0,s.createElementVNode)("div",null,(0,s.toDisplayString)(o.selected.type),1)])}]]),ks={class:"container"},fs={class:"list-container"},gs={class:"grid"},bs=["onClick"],ws={class:"textwrap w100 tcenter"},Es={class:"textwrap w100"},Bs={style:{display:"flex","justify-content":"center"}},Vs={key:0,class:"info"},Ns={name:"ItemsLib",data:()=>({current:null}),props:{selected:{type:Object},list:{type:Array},options:{type:Object,default:{id:"uid",name:"name",icon:"icon",icontip:"tooltip"}}},watch:{selected:{handler(e,t){this.current=e},deep:!0}},methods:{selectItem(e){this.current=e,this.$emit("select",e)}}},Cs=(0,B.A)(Ns,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("icon"),c=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",ks,[(0,s.createElementVNode)("div",fs,[(0,s.createElementVNode)("div",gs,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.list,((t,o)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{onClick:e=>a.selectItem(t),class:"grid-element"},[(0,s.renderSlot)(e.$slots,"item",{},(()=>[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",ws,[(0,s.createTextVNode)((0,s.toDisplayString)(t.name||t.uid),1)])),[[c,t.name||t.uid]]),(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",Es,[(0,s.createTextVNode)((0,s.toDisplayString)(t.url),1)])),[[c,t.url]]),(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",Bs,[(0,s.createVNode)(i,{value:t.icon,size:"2em"},null,8,["value"])])),[[c,t.type]])]),!0)],8,bs)))),256))])]),l.current?((0,s.openBlock)(),(0,s.createElementBlock)("div",Vs,[(0,s.renderSlot)(e.$slots,"edit",{current:l.current},(()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.$slots),1)]),!0)])):(0,s.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-f00e648a"]]),Ss={class:"form-container"},xs={class:"info"},$s={class:"row"},As={class:"rowvalue"},Ds={class:"row"},Is={class:"rowvalue"},Ts={class:"row"},Ms={class:"rowvalue"},Ls={name:"ModuleEdit",props:{current:{type:Object,default:{name:"-"}}},methods:{onEdit(e,t){this.$emit("edit",e,t)}}},js=(0,B.A)(Ls,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("LabelEdit");return(0,s.openBlock)(),(0,s.createElementBlock)("div",Ss,[(0,s.createElementVNode)("div",xs,[(0,s.createElementVNode)("div",$s,[t[3]||(t[3]=(0,s.createElementVNode)("div",{class:"rowlabel"},"Имя",-1)),(0,s.createElementVNode)("div",As,[(0,s.createVNode)(i,{style:{width:"100%"},"onUpdate:value":t[0]||(t[0]=e=>a.onEdit("name",e)),tooltip:"Имя модуля",value:o.current.name},null,8,["value"])])]),(0,s.createElementVNode)("div",Ds,[t[4]||(t[4]=(0,s.createElementVNode)("div",{class:"rowlabel"},"Ссылка",-1)),(0,s.createElementVNode)("div",Is,[(0,s.createVNode)(i,{style:{width:"100%"},"onUpdate:value":t[1]||(t[1]=e=>a.onEdit("entry",e)),value:o.current.entry},null,8,["value"])])]),(0,s.createElementVNode)("div",Ts,[t[5]||(t[5]=(0,s.createElementVNode)("div",{class:"rowlabel"},"Точка входа",-1)),(0,s.createElementVNode)("div",Ms,[(0,s.createVNode)(i,{style:{width:"100%"},"onUpdate:value":t[2]||(t[2]=t=>e.$emit("edit","index",t)),tooltip:"Имя основного блока",value:o.current.index},null,8,["value"])])])])])}]]),_s={class:"form-container"},Fs={class:"info"},zs={class:"row"},Us={class:"rowvalue"},Os={class:"row"},Ps={class:"rowvalue"},Rs=["value"],Hs=["value"],Ws={key:1},qs={class:"row"},Xs={class:"rowvalue"},Js={key:0},Ys={name:"AssetEdit",props:{current:{type:Object,default:{name:"-"}},progress:{type:Number}},computed:{types(){return this.$app.assets.types}},methods:{end(){this.$emit("edit","name",this.$refs.nameeditor.endEdit()),this.$emit("edit","url",this.$refs.urleditor.endEdit())}}},Ks=(0,B.A)(Ys,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("LabelEdit");return(0,s.openBlock)(),(0,s.createElementBlock)("div",_s,[(0,s.createElementVNode)("div",Fs,[(0,s.createElementVNode)("div",zs,[t[3]||(t[3]=(0,s.createElementVNode)("div",{class:"rowlabel"},"NAME",-1)),(0,s.createElementVNode)("div",Us,[(0,s.createVNode)(i,{style:{width:"100%"},ref:"nameeditor","onUpdate:value":t[0]||(t[0]=t=>e.$emit("edit","name",t)),value:o.current.name},null,8,["value"])])]),(0,s.createElementVNode)("div",Os,[t[4]||(t[4]=(0,s.createElementVNode)("div",{class:"rowlabel"},"TYPE",-1)),(0,s.createElementVNode)("div",Ps,[o.current.uid?((0,s.openBlock)(),(0,s.createElementBlock)("div",Ws,(0,s.toDisplayString)(o.current.type),1)):((0,s.openBlock)(),(0,s.createElementBlock)("select",{key:0,class:"typeslist",value:o.current.type,onChange:t[1]||(t[1]=t=>e.$emit("edit","type",t.target.value))},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(a.types,(e=>((0,s.openBlock)(),(0,s.createElementBlock)("option",{value:e},(0,s.toDisplayString)(e),9,Hs)))),256))],40,Rs))])]),(0,s.createElementVNode)("div",qs,[t[5]||(t[5]=(0,s.createElementVNode)("div",{class:"rowlabel"},"URL",-1)),(0,s.createElementVNode)("div",Xs,[(0,s.createVNode)(i,{style:{width:"100%"},ref:"urleditor","onUpdate:value":t[2]||(t[2]=t=>e.$emit("edit","url",t)),value:o.current.url},null,8,["value"])])])]),o.progress>0?((0,s.openBlock)(),(0,s.createElementBlock)("div",Js,(0,s.toDisplayString)(o.progress),1)):(0,s.createCommentVNode)("v-if",!0)])}]]),Gs={class:"importer"},Zs={class:"row"},Qs={class:"row"},ea={class:"label"},ta={class:"row"},oa={class:"label"},na={class:"row"},la={class:"label"},sa={name:"Importer",data:()=>({merge:!1,assets:new Set,elements:new Set,slides:new Set}),methods:{onChangeElements(e){e.isSelected?this.elements.add(e.path):this.elements.delete(e.path),this.$emit("changelist",{assets:this.assets,elements:this.elements,slides:this.slides})},onChangeSlides(e){e.isSelected?this.slides.add(e.uid):this.slides.delete(e.uid),this.$emit("changelist",{assets:this.assets,elements:this.elements,slides:this.slides})},onChangeAssets(e){e.isgroup?e.isSelected?e.children.map((e=>this.assets.add(e.uid))):this.assets.clear():e.isSelected?this.assets.add(e.uid):this.assets.delete(e.uid),this.$emit("changelist",{assets:this.assets,elements:this.elements,slides:this.slides})}},props:{project:{type:Object}},components:{TreeView:Yt},computed:{assetsTree(){return this.project.assets.reduce(((e,t)=>{let o=e.find((e=>e.type===t.type));return o||(o={isgroup:!0,type:t.type,children:[],uid:t.type},e.push(o)),o.children.push(t),e}),[])}}},aa=(0,B.A)(sa,[["render",function(e,t,o,n,l,a){const i=(0,s.resolveComponent)("TreeView");return(0,s.openBlock)(),(0,s.createElementBlock)("div",Gs,[(0,s.createElementVNode)("div",Zs,[(0,s.createElementVNode)("div",null,[t[2]||(t[2]=(0,s.createTextVNode)("Импортировать в текущий проект ")),(0,s.withDirectives)((0,s.createElementVNode)("input",{type:"checkbox",onChange:t[0]||(t[0]=t=>e.$emit("options",{merge:l.merge})),"onUpdate:modelValue":t[1]||(t[1]=e=>l.merge=e)},null,544),[[s.vModelCheckbox,l.merge]])])]),(0,s.createElementVNode)("div",Qs,[t[3]||(t[3]=(0,s.createElementVNode)("div",{class:"title"},"Ресурсы",-1)),(0,s.createElementVNode)("div",null,[(0,s.createVNode)(i,{childsFiled:"children",tree:a.assetsTree,onChangeSelect:a.onChangeAssets},{label:(0,s.withCtx)((({node:e})=>[(0,s.createElementVNode)("div",ea,(0,s.toDisplayString)(e.name||e.uid),1)])),_:1},8,["tree","onChangeSelect"])])]),(0,s.createElementVNode)("div",ta,[t[4]||(t[4]=(0,s.createElementVNode)("div",{class:"title"},"Элементы",-1)),(0,s.createElementVNode)("div",null,[(0,s.createVNode)(i,{childsFiled:"childrenz",tree:o.project.elements,onChangeSelect:a.onChangeElements},{label:(0,s.withCtx)((({node:e})=>[(0,s.createElementVNode)("div",oa,(0,s.toDisplayString)(e.name||e.uid),1)])),_:1},8,["tree","onChangeSelect"])])]),(0,s.createElementVNode)("div",na,[t[5]||(t[5]=(0,s.createElementVNode)("div",{class:"title"},"Слайды",-1)),(0,s.createElementVNode)("div",null,[(0,s.createVNode)(i,{childsFiled:"childrenz",tree:o.project.slides,onChangeSelect:a.onChangeSlides},{label:(0,s.withCtx)((({node:e})=>[(0,s.createElementVNode)("div",la,(0,s.toDisplayString)(e.name||e.uid),1)])),_:1},8,["tree","onChangeSelect"])])])])}]]);let ia="defaultDB",ca=null,ra=[],da="id";class pa{static Init(e,t,o="id"){ia=e,ra=t,da=o}static async openDatabase(e){return new Promise(((t,o)=>{const n=indexedDB.open(ia);n.onupgradeneeded=e=>{const t=e.target.result;for(let e=0;e<ra.length;e++)t.objectStoreNames.contains(ra[e])||t.createObjectStore(ra[e],{keyPath:da,autoIncrement:!1})},n.onsuccess=n=>{if(ca=n.target.result,ca.objectStoreNames.contains(e))t(ca);else{ca.close();const n=ca.version+1,l=indexedDB.open(ia,n);l.onupgradeneeded=t=>{t.target.result.createObjectStore(e,{keyPath:"id",autoIncrement:!0})},l.onsuccess=e=>{ca=e.target.result,t(ca)},l.onerror=e=>{o(e.target.error)}}},n.onerror=e=>{o(e.target.error)}}))}static async addItem(e,t){const o=(await pa.openDatabase(e)).transaction(e,"readwrite");return o.objectStore(e).add(t),new Promise((e=>{o.oncomplete=()=>e(),o.onerror=()=>e()}))}static async addItems(e,t){const o=[];for(let n=0;n<t.length;n++)o.push(pa.addItem(e,t[n]));await Promise.all(o)}static async getItem(e,t){const o=(await pa.openDatabase(e)).transaction(e,"readonly").objectStore(e);return new Promise(((e,n)=>{const l=o.get(t);l.onsuccess=()=>e(l.result),l.onerror=()=>e()}))}static async deleteItem(e,t){const o=(await this.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise(((e,n)=>{const l=o.delete(t);l.onsuccess=()=>e(),l.onerror=()=>n()}))}static async getAllItems(e){const t=(await pa.openDatabase(e)).transaction(e,"readonly").objectStore(e);return new Promise(((e,o)=>{const n=t.getAll();n.onsuccess=()=>e(n.result),n.onerror=()=>e()}))}static async updateItem(e,t){const o=(await pa.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise(((e,n)=>{const l=o.put(t);l.onsuccess=()=>e(t),l.onerror=()=>n()}))}static async updateItemProperties(e,t,o){const n=(await pa.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise(((e,l)=>{const s=n.get(t);s.onsuccess=()=>{const t=s.result;if(t){Object.assign(t,o);const s=n.put(t);s.onsuccess=()=>e(),s.onerror=()=>l()}else l("Item not found")},s.onerror=()=>l()}))}static async upsertItemProperties(e,t,o){const n=(await pa.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise(((e,l)=>{const s=n.get(t);s.onsuccess=()=>{let a=s.result;if(a){Object.assign(a,o);const t=n.put(a);t.onsuccess=()=>e(),t.onerror=()=>l()}else{const s={...o,id:t},a=n.add(s);a.onsuccess=()=>e(),a.onerror=()=>l()}},s.onerror=()=>l()}))}}const ma=pa;var ua=o(949);let ha=0;const va=(0,s.reactive)({list:[],add({message:e,icon:t,onclick:o,timehide:n=!0,type:l,...a},i=(0,s.markRaw)(Ln)){const c=(0,s.reactive)({id:ha++,data:{message:e,icon:t,type:l,...a},component:i});return n&&(c.timeout=setTimeout((()=>{va.remove(c.id)}),3e3)),c.onclick=o||va.remove.bind(this,c.id),va.list.push(c),c},remove(e){for(let t=va.list.length-1;t>=0;t--)va.list[t].id===e&&va.list.splice(t,1)}}),ya=va,ka=(0,s.ref)(!1),fa=(0,s.reactive)({isVisible:!1,header:null,content:null,footer:null,values:null,open({header:e,content:t,footer:o,...n}){fa.header=e||{},fa.content=t||{},fa.footer=o||{},fa.values={closable:!1,...n},ka.value=!0},close(e){e||(ka.value=!1)},get isVisible(){return ka.value}}),ga=fa,ba=[{name:"engine",entry:"/editor/engine/mf.js",index:"engine"},{name:"tweens",entry:"../mods/tweens/mf.js",index:"tweens"}],wa=[];const Ea=(0,s.reactive)({init:async function(){wa.length=0,await(0,ua.registerRemotes)([...ba,...Ea.remotes.map((e=>({name:e.scope,entry:e.url})))]);const e=ba.map((e=>new Promise((t=>{(0,ua.loadRemote)(`${e.name}/${e.index}`).then((o=>{wa.push({module:o,name:e.name,index:e.index,entry:e.entry}),t()}))}))));await Promise.all(e),await async function(){const e=await ma.getAllItems("modules");await(0,ua.registerRemotes)(e);const t=e.map((e=>new Promise((t=>{(0,ua.loadRemote)(`${e.name}/${e.index}`).then((o=>{wa.push({module:o,name:e.name,index:e.index,entry:e.entry}),t()}))}))));await Promise.all(t)}()},openForm:function(){let e=(0,s.ref)(null);const t={label:"Сохранить",class:"secondary",handler:async()=>{try{await async function(e){(0,ua.registerRemotes)([e]),await(0,ua.loadRemote)(`${e.name}/${e.index}`),await async function(e){await ma.upsertItemProperties("modules",e.index,{id:e.index,...e})}(e)}(e.value)}catch(e){return void ya.add({message:"Ошибка при загрузке модуля"})}ya.add({message:"Модуль успешно загружен"}),ga.close()}},o={label:"Регистрация",class:"secondary",handler:async()=>{n.splice(0,1),n.unshift(t),e.value={name:"ModuleName"}}},n=(0,s.reactive)([o,{label:"Отмена",class:"primary",handler:async()=>{ga.close()}}]);ga.open({header:{value:"Управление модулями",handler:()=>{ga.close()}},content:{component:"ItemsLib",props:{list:wa,selected:e},events:{select:t=>e.value=t},slots:{edit:{component:"ModuleEdit",props:{selected:e.value},events:{edit:(t,o)=>{e.value[t]=o}}}}},footer:{buttons:n}})},remotes:[],async save(){await IndexedDBManager.updateItem(STORENAME_OPTS,{id:"extensions.remotes",value:JSON.parse(JSON.stringify(Ea.remotes))})},async load(e,t){const o=await(0,ua.loadRemote)(`${e}/${t}`);return o.default||o},loads:async e=>(await Promise.allSettled(e.map((e=>(0,ua.loadRemote)(`${e.scope}/${e.module}`))))).map((e=>e.default||e))}),Ba=Ea;let Va;const Na={},Ca=[],Sa=(0,s.reactive)({ready:!1,getAssetsManager:()=>Na.AssetsManager,getSlidesManager:()=>Na.SlidesManager,getFactory:()=>Na.Factory,getManager:e=>Na[e]||Va,async load(){const{AssetsManager:e,CssManager:t,MouseManager:o,ActionsManager:n,ElementModel:l,ProjectManager:s,SlidesManager:a,Factory:i,Manager:c,assets:r}=await Ba.load("engine","engine");Na.AssetsManager=e,Na.SlidesManager=a,Na.Factory=i,Na.MouseManager=o,Na.ActionsManager=n,Na.CssManager=t,Va=s,Sa.ready=!0;const d=[];for(let e=0;e<Ca.length;e++)d.push(Ca[e](Va));return Ca.length=0,await Promise.all(d),Va},onload(e){Ca.push(e)}}),xa=Sa,$a=wo.default||wo,Aa=(0,s.reactive)({init:async function(){const e=await ma.getAllItems("actions");await xa.getManager("ActionsManager").Init(e),Aa.list=e},addAction(e){Aa.list[e.uid]=e},parameters:{tween:[{type:"float",name:"delay",default:0},{type:"float",name:"time",default:0}]},list:{},get values(){return Object.values(Aa.list)},library:[],async registerActionComponent(e=[]){const t=Object.fromEntries(e.map((e=>[e.id,e.value]))),{name:o,entry:n,ui:l,action:s}=t;Ba.add({name:o,entry:n}),await Ba.load(o,o)},openLib(e){let t=(0,s.reactive)({selected:null});ga.open({header:{value:"Создать новый исполнитель (action)",handler:()=>{ga.close(),e()}},content:{component:"ActionsLib",props:t},footer:{buttons:[{label:"Регистрация",handler:()=>{t.selected={}}},{label:"Закрыть",handler:()=>{ga.close(),e()}}]}})},exportData:()=>JSON.parse(JSON.stringify(Aa.list))});$a.On("init",(()=>{}));const Da=Aa;async function Ia(e,t,o,n){let l=n||function(){};const s=Ta.list.find((t=>t.uid===e.uid));if(s)Object.keys(e).forEach((t=>{s[t]=e[t]})),await xa.getAssetsManager().UpdateAsset(e,o.prop,l),await ma.updateItem("assets",JSON.parse(JSON.stringify({id:e.uid,...e})));else{e.uid=`asset_${Date.now()}`;try{await xa.getAssetsManager().AddAsset(e,l)}catch(e){return void ya.add({message:"Ошибка при загрузке ресурса: "+e.message})}Ta.list.push(e),await ma.addItem("assets",JSON.parse(JSON.stringify({id:e.uid,...e}))),ya.add({message:"Ресурс успешно загружен"})}}const Ta=(0,s.reactive)({init:async function(){const e=await ma.getAllItems("assets");await xa.getManager("AssetsManager").Init(e),e.forEach((e=>e.isAsset=!0)),Ta.list.push(...e)},save:Ia,updateAsset:async function(e,t,o){await xa.getAssetsManager().UpdateAsset(e,t,o),await ma.updateItem("assets",JSON.parse(JSON.stringify({id:e.uid,...e})))},selectAsset:function(e,t){const o=(0,s.reactive)({selected:null,list:Ta.list.filter((t=>!e.includes(t.type)))}),n={label:"Выбрать",class:"secondary",handler:async()=>{t(o.selected),ga.close()}},l={label:"Регистрация",class:"secondary",handler:async()=>{a.splice(0,1),a.unshift(n),o.selected={name:"",type:Ta.list.filter((t=>!e.includes(t.type)))[0],url:""}}},a=(0,s.reactive)([l,{label:"Отмена",class:"primary",handler:async()=>{ga.close()}}]);ga.open({header:{value:"Выберите ресурс",handler:()=>{ga.close()}},content:{component:"ItemsLib",props:o,events:{select:e=>{o.selected=e,2===a.length&&a.unshift(n)}},slots:{edit:{component:"AssetEdit",props:{selected:o.selected},events:{edit:(e,t)=>{o.selected[e]=t}}}}},footer:{buttons:a}})},editAsset:function(e){const t=(0,s.reactive)({current:e}),o=(0,s.reactive)([{label:"Сохранить",class:"secondary",handler:async()=>{await Ia(e,0,null,(({loaded:t,total:o})=>{e.progress=t/o*100})),ga.close()}},{label:"Отмена",class:"primary",handler:async()=>{ga.close()}}]);ga.open({header:{value:"Выберите ресурс",handler:()=>{ga.close()}},content:{component:"AssetEdit",props:t,events:{edit:(t,o)=>{e[t]=o}}},footer:{buttons:o}})},types:["gltf","texture","hdr"],list:[],get assetsTree(){return Ta.list.reduce(((e,t)=>{let o=e.find((e=>e.type===t.type));return o||(o={isgroup:!0,type:t.type,children:[],uid:t.type},e.push(o)),o.children.push(t),e}),[])},removeAsset(e){const t=Ta.list.findIndex((t=>t.uid===e.uid));if(t>=0){const e=Ta.list.splice(t,1);xa.getAssetsManager().RemoveAsset(e[0])}},exportData:()=>JSON.parse(JSON.stringify(Ta.list))}),Ma=Ta,La=(0,s.reactive)({uid:"",selected:null,slide:{},select(e){if(La.selected=e,!La.selected)return ce.Select(null),void(La.uid=null);La.uid=La.selected.uid,e.model?.isElement&&ce.Select(La.selected.model)}}),ja=La;async function _a(e){const t=Fa.list.find((t=>t.uid===e.paths[0])).exportData();await ma.updateItem("elements",{id:t.uid,...t})}const Fa=(0,s.reactive)({init:async function(){const e=await ma.getAllItems("elements");if(0===e.length){const t={uid:"camroot",type:"block",path:"camroot",paths:["camroot"],children:[{uid:"maincam",type:"PerspectiveCamera",path:"camroot.maincam",paths:["camroot","maincam"]}]};e.push(t),await ma.addItem("elements",{id:t.uid,...t})}const t=await xa.getManager().Build(e);for(let e=0;e<t.length;e++){const o=t[e],n=(0,s.reactive)(o);Fa.list.push(n)}},create:async function(e,t){let o;if(t){let e=Fa.list;for(let n=0;n<t.paths.length;n++){const l=t.paths[n];o=e.find((e=>e.uid===l)),e=o.children}}const n=await xa.getManager("Factory").BuildElement(e,o||xa.getManager().Root),l=n.exportData();n.isBlock?(Fa.list.push(n),await ma.addItem("elements",{id:l.uid,...l})):(t.data.children.push(n.data),_a(n.data))},edit:function(e,t,o){t in e||(e[t]=o,(0,s.watch)((()=>e[t]),(o=>{e.model[t]=o}))),e.data[t]=e[t]=e.model[t]=o,_a(e)},remove:async function(e){if(ja.selected===e&&ja.select(null),e.isBlock){slides.removeState(e.uid);const t=Fa.list.findIndex((t=>t.uid===e.uid));t>=0&&Fa.list.splice(t,1),await ma.deleteItem("elements",e.uid)}else{const t=e.parent;t.remove(e);const o=t.data.children.findIndex((t=>t.uid===e.uid));o>=0&&t.data.children.splice(o,1),_a(t)}},findElement:function(e){let t=Fa,o=Fa.list;for(let n=0;n<e.length;n++)t=o.find((t=>t.uid===e[n])),o=t.children;return t},save:_a,exportData:function(){const e=Fa.list.map((e=>e.exportData()));return JSON.parse(JSON.stringify(e))},types:["block","model","camera","DirectionalLight","AmbientLight"],list:[]}),za=Fa,Ua={uid:null,path:"",type:"slide",name:"New Slide",children:[]};let Oa;const Pa=(0,s.reactive)({init:async function(){const e=await ma.getAllItems("slides");if(0===e.length){const t={uid:"base",type:"slide",name:"Base",scene:{background:{},environment:{}},camera:{uid:"camroot.maincam"},children:[{uid:"camroot"}]};e.push(t),await ma.addItem("slides",{id:t.uid,...t})}Pa.list.length=0,Oa=xa.getSlidesManager(),Oa.on("change",((e,t)=>{Pa.actived=Pa.list.find((t=>t.uid===e.uid))}));const t=Oa.AddSlides(e);for(let e=0;e<t.length;e++){const o=(0,s.reactive)(t[e]);for(let e=0;e<o.children.length;e++){const t=(0,s.reactive)(o.children[e]);t.model=za.findElement(t.paths),t.model.state=t,o.children[e]=t}Pa.list.push(o)}},create:function(e){e.uid=`sl${Date.now()}`;const t={...structuredClone(Ua),...e},o=Oa.AddSlide(t),n=(0,s.reactive)(o);return Pa.list.push(n),ya.add({message:`Слайд ${n.name} добавлен`}),n},edit:function(e){},remove:function(e){},createState:function(){},editState:function(){},removeState:function(){},save:async function(e){const t=e.exportData();await ma.updateItem("slides",{id:t.uid,...t})},saveState:async function(e){const t=e.slide.exportData();await ma.updateItem("slides",{id:t.uid,...t})},actived:null,list:[],async goto(e){Pa.actived="number"==typeof e?Pa.list[e]:Pa.list.find((t=>t.uid===e)),await xa.getSlidesManager().GoTo(e),ja.select(null)},update(){},remove(){},find:e=>Pa.list.find((t=>t.uid===e)),async addState(e,t){const o=Pa.list.find((t=>t.uid===e)),n=za.findElement(t),l={uid:n.uid,name:n.name||"",paths:n.paths},a=xa.getSlidesManager().CreateState(l),i=(0,s.reactive)(a);i.model=za.findElement(n.paths),i.model.state=i,o.addState(i),a.activate(),await saveSlide(o)},removeState(e,t){for(let o=0;o<Pa.list.length;o++){const n=Pa.list[o];if(t&&n.uid!==t)continue;const l=n.children.findIndex((t=>t.path===e));l>=0&&n.children.splice(l,1).forEach((e=>{e.model.state=null,e.model.visible=!1}))}},exportData:()=>JSON.parse(JSON.stringify(Pa.list.map((e=>({...e.exportData(),children:e.children.map((e=>({...e.data})))})))))}),Ra=Pa,Ha=o.p+"5f00000410434e1a50e7.json",Wa=wo.default||wo,qa=[Ha];let Xa;async function Ja(e,t,o){return/Mobi|Android/i.test(navigator.userAgent)?async function(e,t){t.getContext("2d").drawImage(document.documentElement,0,0,t.width,t.height);const o=t.toDataURL("image/png"),n=document.createElement("a");n.href=o,n.download=`${e}.png`,n.click()}(e,t):async function(e,t={}){try{const o=(await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"tabs"},audio:!1,selfBrowserSurface:"include",surfaceSwitching:"exclude",...t})).getVideoTracks()[0];let n=new ImageCapture(o);const l=await n.grabFrame(),s=document.createElement("canvas");s.width=l.width,s.height=l.height,s.getContext("2d").drawImage(l,0,0);const a=s.toDataURL("image/png"),i=document.createElement("a");i.href=a,i.download=`${e}.png`,i.click()}catch(e){console.warn(e)}}(e,o)}async function Ya(e){const t=document.createElement("video");t.height=window.height,t.width=window.width;const o=t.srcObject=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"tabs"},audio:!1,selfBrowserSurface:"include",surfaceSwitching:"exclude"}),n=new MediaRecorder(o),l=[];n.ondataavailable=e=>l.push(e.data),n.onerror=e=>{console.warn(e.message)},n.onstop=()=>{const t=new Blob(l,{type:"mp4"});o.getVideoTracks()[0].stop();const n=`${e}.mp4`;if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(t,n);else{const e=window.document.createElement("a");e.href=window.URL.createObjectURL(t),e.download=n,e.style="display: none",e.click()}},n.start()}function Ka(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()}async function Ga(){const e={uid:"currproject",id:"currproject",actions:Da.exportData(),assets:Ma.exportData(),elements:za.exportData(),slides:Ra.exportData()};return await ma.updateItem("projects",e),e.uid}const Za=(0,s.reactive)({switchScreen:Ka,captureVideo:Ya,captureImage:Ja,init:async function(e){Xa=e,await ma.Init(e,["projects","assets","elements","slides","actions","modules"],"uid"),await Wa.modules.init(),await Wa.engine.load()},load:async function(){await Wa.assets.init(),await Wa.actions.init(),await Wa.elements.init(),await Wa.slides.init()},save:Ga,ready:!1,cameras:[],player:null,header:{buttons:[{icon:"play3",tooltip:"Запуск",handler:async function(){Za.player=window.open(`../player?src=${Xa}`,"Player")}},{icon:"floppy-disk",tooltip:"Сохранить",handler:Ga},{icon:"upload",tooltip:"Экспорт проекта",handler:async function(){const e=await async function(){const e=await Da.exportData(),t=await Ma.exportData(),o=await za.exportData(),n=await Ra.exportData();return JSON.parse(JSON.stringify({actions:e,assets:t,elements:o,slides:n}))}(),t=new Blob([JSON.stringify(e)],{type:"application/json"}),o="project.json";if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(t,o);else{const e=window.document.createElement("a");e.href=window.URL.createObjectURL(t),e.download=o,e.style="display: none",e.click()}}},{icon:"download",tooltip:"Импорт проекта",handler:async function(){try{const e=await function(e=".json"){return new Promise((t=>{const o=document.createElement("input");o.type="file",o.accept=e,o.style.display="none",o.addEventListener("change",(()=>{o.files&&o.files[0]&&t(o.files[0]),document.body.removeChild(o)})),document.body.appendChild(o),o.click()}))}(),t=await function(e){return new Promise(((t,o)=>{if(!e.name.endsWith(".json"))return void o(new Error("Выберите файл с расширением .json"));const n=new FileReader;n.onload=e=>{try{const o=JSON.parse(e.target.result);t(o)}catch(e){o(new Error("Ошибка парсинга JSON: "+e.message))}},n.onerror=()=>{o(new Error("Ошибка чтения файла"))},n.readAsText(e)}))}(e);let o=!1;const n=(0,s.reactive)({assets:{},elements:{},slides:{}});return ga.open({header:{value:"Импорт",handler:()=>{ga.close()}},content:{component:"Importer",props:{project:t},events:{options:e=>{o=e.merge},changelist:e=>{Object.keys(e).forEach((t=>{n[t]=e[t]}))}}},footer:{buttons:[{label:"Импорт",class:"secondary",handler:async()=>{const e=`project${Date.now()}`;await ma.Init(e,["projects","assets","elements","slides","actions","modules"],"uid"),await ma.addItems("assets",t.assets),await ma.addItems("elements",t.elements),await ma.addItems("slides",t.slides);const o=new URL(window.location.href);o.searchParams.set("project",e),window.location.href=o.toString(),ga.close()}},{label:"Отмена",class:"primary",handler:async()=>{ga.close()}}]}}),t}catch(e){throw console.error("Ошибка:",e.message),e}}},{icon:"pacman",tooltip:"Пример 1",handler:async function(e){const t=qa[e],o=await fetch(t),n=await o.json(),l=`project${e}`;await ma.Init(l,["projects","assets","elements","slides","actions","modules"],"uid"),await ma.addItems("assets",n.assets),await ma.addItems("elements",n.elements),await ma.addItems("slides",n.slides);const s=new URL(window.location.href);s.searchParams.set("project",l),window.location.href=s.toString()}.bind(null,0)}]},footer:{buttons:[{icon:"camera",tooltip:"Скриншот",handler:Ja},{icon:"film",tooltip:"Видео",handler:Ya},{icon:"books",tooltip:"Модули",handler:Ba.openForm},{icon:"enlarge",tooltip:"Экран",handler:Ka},{icon:"cog",tooltip:"Настройки",handler:Ja}]}}),Qa=Za,ei=(0,s.reactive)({types:["enable.on","disable.on","slide.in","slide.out","mouse.in","mouse.over","mouse.out","mouse.click","tick"]}),ti=[{type:"float",component:Ol}],oi={gltf:[{label:"URL",prop:"url",component:"LabelEdit"},{label:"Клонировать",component:"BoolEdit",prop:"clone"},{label:"Создавать тень",component:"BoolEdit",prop:"shadow.cast"},{label:"Получать тень",component:"BoolEdit",prop:"shadow.receive"},{label:"Карта окружения",component:"asset",prop:"envMap"}],DirectLight:[{label:"Трансформ",component:"transformedit"},{label:"Цвет",component:"EditColor",values:{property:"color"}},{label:"Интенсивность",component:"FloatValue",values:{property:"intensity",step:.1,min:0}},{label:"События",component:"EventsList"},{label:"Видимость",prop:"view",component:"BoolEdit"}],AmbientLight:[{label:"Цвет",component:"EditColor",values:{property:"color"}},{label:"Интенсивность",component:"FloatValue",values:{property:"intensity",step:.1,min:0}},{label:"События",component:"EventsList"},{label:"Видимость",prop:"view",component:"BoolEdit"}],block:[{label:"Трансформ",component:"transformedit"},{label:"Видимость",prop:"view",component:"BoolEdit"}],model:[{label:"Трансформ",component:"transformedit"},{label:"Видимость",prop:"view",component:"BoolEdit"},{label:"Ресурсы",component:"assetsview"},{label:"События",component:"EventsList"}],PerspectiveCamera:[{label:"Трансформ",component:"transformedit"},{label:"Видимость",prop:"view",component:"BoolEdit"},{label:"FOV",prop:"fov",component:"Int",onupdate(e,t,o,n){e.fov=t,e.updateProjectionMatrix(),e.exportData=function(){return JSON.parse(JSON.stringify({properties:{fov:e.fov,visible:e.visible},name:e.name,uid:e.uid,path:e.path,paths:e.paths,type:e.type}))},n(e)}}]},ni=(0,s.reactive)({ready:!1,cameras:[],getFieldTypes:()=>ti,getTypesBlock:e=>oi[e]||[]}),li=document.createElement("div");let si;li.className="tooltip",li.style.position="absolute",li.style.visibility="hidden",document.body.appendChild(li);const ai={beforeMount(e,t){const o=()=>{si=e,li.textContent=t.value;const o=e.getBoundingClientRect();let n=o.left+window.scrollX+o.width/2-li.offsetWidth/2,l=o.top+window.scrollY-li.offsetHeight-5;n+li.offsetWidth>window.innerWidth&&(n=window.innerWidth-li.offsetWidth-10),n<0&&(n=10),l+li.offsetHeight>window.innerHeight&&(l=o.top+window.scrollY+o.height+5),l<0&&(l=o.top+window.scrollY+o.height+5),li.style.left=`${n}px`,li.style.top=`${l}px`,li.style.visibility="visible"},n=()=>{si===e&&(li.style.visibility="hidden")};e.__tooltipHandlers__={mouseEnterHandler:o,mouseLeaveHandler:n},e.addEventListener("mouseenter",o),e.addEventListener("mouseleave",n)},unmounted(e){const{mouseEnterHandler:t,mouseLeaveHandler:o}=e.__tooltipHandlers__||{};t&&e.removeEventListener("mouseenter",t),o&&e.removeEventListener("mouseleave",o),si===e&&(li.style.visibility="hidden")}},ii=wo.default||wo;(0,ua.init)({name:"3d.editor",remotes:[]});const ci=window.vue=(0,s.createApp)(Go);ci.use((e=>{e.config.globalProperties.$app=ii.Init(l)})),Object.keys(n).forEach((e=>{ci.component(e,n[e])})),ci.provide("globalComponents",ci._context.components),ci.directive("tooltip",ai),ci.mount("#app"),"serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("/sw.js",{scope:"/"}).then((e=>{})).catch((e=>{console.error("SW failed:",e)}))}))}},e=>{e.O(0,[585],(()=>e(e.s=853))),e.O()}]);