"use strict";(self.webpackChunk_reneos_3d_editor_engine=self.webpackChunk_reneos_3d_editor_engine||[]).push([[103,614],{30:(e,t,s)=>{s.d(t,{A:()=>n});var a=s(909);class i extends a.Object3D{static get IsElement(){return!0}constructor(e){super(),this.isElement=!0,this.isBase=!0,this.uid=e.uid,this.data=e,this.type="element",this.actions=e.actions||[],e.position&&(this.position.copy(e.position),this.data.position=this.position.clone()),e.rotation&&(this.rotation.setFromVector3(e.rotation,"XYZ"),this.data.rotation=this.rotation.clone()),e.scale&&(this.scale.copy(e.scale),this.data.scale=this.scale.clone())}exportData(){const{model:e,children:t,...s}=this.data,a=JSON.parse(JSON.stringify(s));if(this.data.rotation&&(a.rotation={x:this.data.rotation.x,y:this.data.rotation.y,z:this.data.rotation.z}),t){a.children=[];for(let e=0;e<t.length;e++){const s=t[e],i=this.children.find((e=>e.uid===s.uid));a.children[e]=i.exportData?i.exportData():JSON.parse(JSON.stringify(i.data||{}))}}return a}addAction(e){this.actions.push(e)}get model(){return this}find(e){const t=e.split(".");let s=this;for(let e=0;e<t.length;e++)s=this.children.find((s=>s.uid===t[e])),list=s.children;return s}get view(){return this.visible}set view(e){this.visible=e,this.data.view=e}}const n=i},103:(e,t,s)=>{s.r(t),s.d(t,{ActionsManager:()=>m,AssetsManager:()=>o.A,BaseElement:()=>n.C6,CssManager:()=>E.A,ElementModel:()=>n.Kx,Factory:()=>n.$7,MouseManager:()=>c.A,ProjectManager:()=>r.A,SlidesManager:()=>M,THREE:()=>i});var a=s(909),i=s.t(a,2),n=s(539),o=s(304),r=(s(314),s(404)),c=s(337);const l={goto:function(e,t,s){M.GoTo(e.slide)},gonext:function(e,t,s){M.GoToNext()},goback:function(e,t,s){M.GoToBack()},func:function(e,t){let s=t;if(e.paths)for(let t=0;t<e.paths.length;t++)s=s[e.paths[t]];if("function"==typeof s[e.method])return s[e.method](e.values,t);throw new Error("No method")},visible:async function(e,t,s){let a=t;if(console.log("VISIBLE"),e.paths)for(let t=0;t<e.paths.length;t++)a=a[e.paths[t]];if(e.target)for(let t=0;t<e.target.length;t++)a=a.children.find((s=>s.uid===e.target[t]));a.visible=e.value},propset:function(e,t,s){let a=t;for(let t=0;t<e.paths.length;t++)a=a[e.paths[t]];a[e.property]=e.value}},d={goto:{uid:"goto",type:"goto",handler:l.goto},gotoNext:{uid:"gotoNext",type:"gonext",handler:l.gonext},gotoBack:{uid:"gotoBack",type:"goback",handler:l.goback},callFunc:{uid:"callFunc",type:"func",handler:l.func},cameraSet:{uid:"cameraSet",type:"func",handler:l.func,paths:["model"],method:"activate",values:{}},visibleSet:{uid:"visibleSet",type:"visible",handler:l.visible,paths:[]},propset:{uid:"propset",type:"propset",handler:l.propset}};async function h(e,t){console.log("run");for(const s of e)try{const e=d[s.uid];await e.handler({...e,...s},t,s),s.actions&&await h(s.actions,t)}catch(e){console.warn(e)}}function u(e,t,s){console.log("collect");const a=e.actions.filter((e=>e.hook===t));if(a.length>0&&s.push(h(a,e)),e.children)for(let a=0;a<e.children;a++){const i=e.children[a];i.actions&&u(i,t,s)}}class p{static get Library(){return d}static Init(e){Object.entries(e).forEach((([e,t])=>{t.handler=l[t.type],d[e]=t})),c.A.on("click",(e=>{p.Run([...e.actions,...e.state.actions],e,"mouse.click.self")}))}static GetAction(e){return l[e]}static RegisterAction(e,t){l[e]=t,Object.values(d).forEach((t=>{t.type===e&&(t.handler=l[t.type])}))}static async Run(e=[],t,s){const a=e.filter((e=>e.hook===s));0!==a.length&&await h(a,t)}static async Execute(e,t){const s=[];for(let a=0;a<e.length;a++)u(e[a],t,s);await Promise.all(s)}}const m=p;var g=s(351);const y=[],w=[];let f;const v=new g.A;class b{static AddSlides(e){const t=[];for(let s=0;s<e.length;s++){const a=b.AddSlide(e[s]);t.push(a)}return t}static AddSlide(e){const t=new A(e);for(let s=0;s<e.children.length;s++){const a=e.children[s],i=new x(a,r.A.FindBlock(a.uid));if(i.slide=t,a.children)for(let e=0;e<a.children.length;e++){const t=b.AddState(a.children[e],i.model);i.children.push(t)}t.addState(i)}return y.push(t),t}static AddState(e,t,s=!0){const a=t||r.A.Root,i=new x(e,a.children.find((t=>t.uid===e.uid)));if(s&&(i.model.visible=!0),e.children)for(let t=0;t<e.children.length;t++){const s=b.AddState(e.children[t],i.model);i.children.push(s)}return i}static CreateState(e){return new x(e,r.A.FindElement(e.paths))}static RemoveState(e,t){}static GoTo(e){const t="number"==typeof e?y[e]:y.find((t=>t.uid===e));t&&f?.uid!==t.uid&&(w[w.length-1]!==t.uid&&w.push(t.uid),b.Activate(t))}static GoToNext(){const e=y.findIndex((e=>e===f));b.GoTo(e+1)}static GoToBack(){w.pop(),w.length>0?b.GoTo(w[w.length-1]):console.warn("История пуста. Невозможно вернуться назад.")}static async Activate(e,t=!1){console.log(`Activate ${e.uid}`);let s=[];f&&(s=f.children,await f.out(e.children,!t)),f=e,v.emit("change",f),await f.in(s,!t)}}class A{constructor(e){this.uid=e.uid,this.name=e.name,this.scene=e.scene,this.camera=e.camera,this.type="slide",this.isSlide=!0,this.children=[],this._actions=e.actions}exportData(){const e=JSON.parse(JSON.stringify({actions:this._actions,scene:this.scene,camera:this.camera,name:this.name,uid:this.uid}));return e.children=this.children.map((e=>e.exportData())),e}addState(e){this.children.push(e),e.slide=this}async in(e){const t=[],s=[];for(let a=0;a<this.children.length;a++){const i=this.children[a];e.findIndex((e=>e.uid===i.uid||i.data.persistent))>=0?s.push(i):t.push(i)}if(this.camera?.uid&&this.camera?.uid!==r.A.Camera.path){const e=this.camera.uid.split(".");let t,s=this.children;for(let a=0;a<e.length;a++){const i=e[a];t=s.find((e=>e.uid===i)).model,s=t.children}r.A.SetCamera(t)}const a=[...t,...s];await m.Execute(t,"enable.on"),this.activate(a),await Promise.all([m.Execute(a,"slide.in.before"),m.Run(this._actions,this,"slide.in.before")]),await Promise.all([m.Execute(a,"slide.in"),m.Run(this._actions,this,"slide.in")]),await Promise.all([m.Execute(a,"slide.in.after"),m.Run(this._actions,this,"slide.in.after")])}async activate(e){for(let t=0;t<e.length;t++){const s=e[t];s.activate(),s.children&&this.activate(s.children)}}async out(e){console.log("out slide");const t=[],s=[];for(let a=0;a<this.children.length;a++){const i=this.children[a];e.findIndex((e=>e.uid===i.uid))>=0?t.push(i):s.push(i)}const a=[...s,...t];await Promise.all([m.Execute(a,"slide.out"),m.Run(this._actions,this,"slide.out")]),await m.Execute(s,"disable.on");const i=[];this.deactivate(s,i),await Promise.all(i)}async deactivate(e,t){console.log("deactivate slide");const s=e;for(let e=0;e<s.length;e++){const a=s[e];t.push(a.deactivate()),a.children&&this.deactivate(a.children,t)}}}class x{constructor(e,t){this.data=e,this.isState=!0,this.type="state",this.model=t,this.state=this,this._actions=e.actions||[],this.data.position&&(this.position=(new a.Vector3).copy(this.data.position)),this.data.rotation&&(this.rotation=(new a.Euler).setFromVector3(this.data.rotation,"XYZ")),this.data.scale&&(this.scale=(new a.Vector3).copy(this.data.scale))}get uid(){return this.data.uid}exportData(){return console.log(this),JSON.parse(JSON.stringify(this.data))}get view(){return this.model.visible}set view(e){this.model.visible=this.data.view=e}get path(){return this.model.path}get paths(){return this.model.paths}addAction(e){this._actions.push(e)}get stateActions(){return this._actions}get actions(){return[...this._actions,...this.model.actions]}activate(){this.model.state=this,this.data.position&&this.model.position.copy(this.data.position),this.data.rotation&&this.model.rotation.setFromVector3(this.data.rotation,"XYZ"),this.data.scale&&this.model.scale.copy(this.data.scale),this.model.visible=this.data.view||!1}deactivate(){console.log("deactivate"),this.model.state=null,this.model.visible=!1}}const S=new Proxy(b,{get:(e,t)=>t in e?e[t]:v[t]});window.SlidesManager=S;const M=S;var E=s(127)},127:(e,t,s)=>{s.d(t,{A:()=>h});var a=s(909),i=s(74),n=s(351),o=s(404);let r;new a.Vector2;const c=new n.A;let l;class d{static Init(e,t){l=t,r=new i.B({element:e}),r.setSize(window.innerWidth,window.innerHeight),r.domElement.style.position="absolute",r.domElement.style.top="0px",o.A.AddToUpdate(d.Render)}static async AddElement(e,t){const s=await l(t),a=new i.v(s);return c.emit("add",a,e),a}static AddLabel(e,t){const s=new i.v(e);return s.position.set(0,0,0),s.center.set(.5,.5),s.layers.set(0),s}static AddHookLine(e,t){}static UpdateHook(e){let t=function(e,t){let s=e.getBoundingClientRect();console.log(e),console.log(s),console.log(s.top,s.right,s.bottom,s.left);let i=e.offsetParent?e.offsetParent.getBoundingClientRect():{left:0,top:0},n=(s.left-i.left+s.width/2)/window.innerWidth*2-1,o=-(s.top-i.top+s.height/2)/window.innerHeight*2+1,r=new a.Vector3(n,o,-2);r.unproject(t);let c=r.sub(t.position).normalize();return t.position.clone().add(c.multiplyScalar(3))}(e.div,o.A.Camera,o.A.Scene);e.points[1].copy(t),e.line.geometry.setFromPoints(e.points)}static Render(){r.render(o.A.Scene,o.A.Camera)}}const h=new Proxy(d,{get:(e,t)=>t in e?e[t]:c[t]})},304:(e,t,s)=>{s.d(t,{A:()=>h});var a=s(351);class i extends a.A{constructor(e){super(),this.data=e,this._resource=null,this.promise=null,this.elements=[],this.progress=0}async load(){}get resource(){return this.data.clone?this._resource.clone():this._resource}async update(){}updateResource(e,t){this._resource=e,this.applyData(t||this.data)}get uid(){return this.data.uid}}const n=i;var o=s(92);var r=s(909);var c=s(231);const l=new Map,d={gltf:class extends n{constructor(e){return super(e),new Proxy(this,{get:(e,t,s)=>t in e?e[t]:e.data[t]})}async load(e){await new Promise(((t,s)=>{(new o.B).load(this.data.url,(async e=>{let s;this._resource=e.scene.children.length>1?e.scene:e.scene.children[0],this.data.position&&this._resource.position.copy(this.data.position),this.data.rotation&&this._resource.rotation.set(this.data.rotation.x,this.data.rotation.y,this.data.rotation.z,"XYZ"),this.data.scale&&this._resource.scale.copy(this.data.scale),this.data.envMap&&(s=await h.GetResource(this.data.envMap)),this._resource.traverse((e=>{e.isMesh&&(this.data.envMap&&(e.material.envMap=s),e.castShadow=this.data.shadow?.cast||!1,e.receiveShadow=this.data.shadow?.receive||!1,e.geometry.computeBoundingBox())})),this.emit("update",this.resource),t()}),e,s)}))}async update(e,t,s){if(console.log(e),this.data[t]=e[t],"url"===t)return this.data.url=e.url,this.load(s);if("envMap"===t){let e;this.data.envMap&&(e=await h.GetResource(this.data.envMap)),this._resource.traverse((t=>{t.isMesh&&(this.data.envMap&&(t.material.envMap=e),t.castShadow=this.data.shadow?.cast||!1,t.receiveShadow=this.data.shadow?.receive||!1,t.geometry.computeBoundingBox())}))}}setElement(e,t={}){this.elements.push({element:e,data:t}),e.add(this.resource.clone()),this.applyData(t)}updateResource(e,t){super.updateResource(e,t);for(let t=0;t<this.elements.length;t++){const t=this.elements,s=t.element.children.find((e=>e.uid===this.data.uid));s!==e&&(t.element.remove(s),t.element.add(this.resource.clone())),this.applyData(t.data)}}async applyData(e){let t;this.resource.position.copy(e.position||{x:0,y:0,z:0}),this.resource.rotation.setFromVector3(e.rotation||{x:0,y:0,z:0},"XYZ"),this.resource.scale.copy(e.scale||{x:1,y:1,z:1}),e.quaternion&&this.resource.quaternion.copy(e.quaternion),e.envMap&&(t=await h.GetAsset(e.envMap).resource),this.resource.traverse((s=>{s.isMesh&&(e.envMap&&(s.material.envMap=t),s.castShadow=e.shadow?.cast||!1,s.receiveShadow=e.shadow?.receive||!1,s.geometry.computeBoundingBox())}))}destroy(){for(let e=0;e<this.elements.length;e++){const e=this.elements;e.elements.children.find((e=>e.uid===this.data.uid))&&e.elements.remove(this.resource)}}},texture:class extends n{constructor(e){super(e)}async load(){const e=new r.TextureLoader;this.resource=await e.load(this.data.url)}setElement(e,t={}){this.element=e,this.elementData=t,this.element.add(this.resource),this.applyData(this.data),this.applyData(this.elementData)}updateResource(e,t){this.element.children.find((e=>e.uid===this.data.uid))!==e&&(this.element.remove(this.resource),this.resource=e,this.element.add(this.resource)),this.applyData(t),this.applyData(this.elementData)}applyData(e){}destroy(){this.element.children.find((e=>e.uid===this.data.uid))&&this.element.remove(this.resource)}},hdr:class extends n{constructor(e){super(e)}load(){return new Promise((e=>{(new c.Y).load(this.data.url,(t=>{t.mapping=r.EquirectangularReflectionMapping,this._resource=t,e()}))}))}setElement(e,t={}){this.element=e,this.elementData=t,this.element.add(this._resource),this.applyData(this.data),this.applyData(this.elementData)}updateResource(e,t){this.element.children.find((e=>e.uid===this.data.uid))!==e&&(this.element.remove(this._resource),this._resource=e,this.element.add(this._resource)),this.applyData(t),this.applyData(this.elementData)}applyData(e){}destroy(){this.element.children.find((e=>e.uid===this.data.uid))&&this.element.remove(this._resource)}},material:class extends n{constructor(e){super(e),this.resource=new r.MeshStandardMaterial,this.elements=[]}async load(){Object.keys(this.data.textures).forEach((async e=>{this.resource[e]=await h.GetResource(this.data.textures[e].uid)})),Object.keys(this.data.properties).forEach((async e=>{this.resource[e]=this.data.properties[e]}))}setElement(e,t={}){this.elements.push({element:e,data:t}),e.add(this.resource.clone()),this.applyData(t)}updateResource(e,t){for(let s=0;s<this.elements.length;s++){const s=this.elements;s.element.children.find((e=>e.uid===this.data.uid))!==e&&(s.element.remove(this.resource),this.resource=e,s.element.add(this.resource.clone())),this.applyData(t),this.applyData(s.data)}}async applyData(e){this.resource.map=h.GetAsset(e.textures.map.uid)}destroy(){for(let e=0;e<this.elements.length;e++){const e=this.elements;e.elements.children.find((e=>e.uid===this.data.uid))&&e.elements.remove(this.resource)}}}},h=class{static GetAsset(e){return l.get(e)}static GetAssets(e){const t=new Set(e);return[...l.values()].filter((e=>t.has(e.uid)))}static GetResource(e){const t=l.get(e);return t.resource?t.resource:(t.promise||(t.promise=new Promise((async e=>{await t.load(),e(t.resource)}))),t.promise)}static async Init(e){for(let t=0;t<e.length;t++){const s=e[t],a=new(0,d[s.type])(s);l.set(a.uid,a)}const t=[];for(const[e,s]of l.entries())t.push(s.load());await Promise.allSettled(t)}static async AddAsset(e,t){const s=new(0,d[e.type])(e);try{await s.load(t)}catch(e){throw e}finally{l.set(s.uid,s)}}static RemoveAsset(e){l.has(e.uid)&&(l.get(e.uid).destroy(),l.delete(e.uid))}static async UpdateAsset(e,t,s){console.log(e,t);const a=l.get(e.uid);try{await a.update(e,t,s)}catch(e){throw e}}}},314:(e,t,s)=>{s.r(t),s.d(t,{default:()=>n});var a=s(30);class i extends a.A{constructor(e){super(e),this.isBlock=!0,this.type="block"}}const n=i},337:(e,t,s)=>{s.d(t,{A:()=>P});var a=s(909),i=s(351);function n(e){for(;e;){if(e.isBlock)return e;e=e.parent}return null}var o=s(24),r=s(0);let c,l;const d=class{static MoveTo(e,t){const s={position:new a.Vector3,time:1e3,...e,control:!1},i={position:new a.Vector3,time:1e3,...t,control:!1};c.enabled=!1;const n=Workspace.Camera.position.clone(),o=c.target.clone();s.control=s.time>i.time,i.control=i.time>=s.time;const r=new Tween(n).to(s.position,s.time).easing(Easing.Quadratic.InOut).onUpdate((()=>{Workspace.Camera.position.copy(n),Workspace.Camera.updateProjectionMatrix(),c.update()})).onComplete((()=>{s.control&&(c.enabled=!0),tweengroup.remove(r)})).start(),l=new Tween(o).to(i.position,i.time).easing(Easing.Quadratic.InOut).onUpdate((()=>{c.target.copy(o),c.getPolarAngle()>c.maxPolarAngle&&c.target.setY(center.y+Math.cos(c.maxPolarAngle)*distance)})).onComplete((()=>{i.control&&(c.enabled=!0),tweengroup.remove(l)})).start();tweengroup.add(r,l)}static SetState(e){c.enabled=e}static Init({canvas:e},t,s){c=new o.N(t,e),c.enabled=!0,c.enableDamping=!0,c.dampingFactor=.25,c.screenSpacePanning=!1,c.minDistance=.01,c.maxDistance=500,l=new r.ZU(t,e),l.addEventListener("dragging-changed",(e=>{c.enabled=!e.value}));const i=l.getHelper();s.add(i),l.getRaycaster().layers.set(1),i.traverse((e=>{e.layers.set(1)})),window.addEventListener("keydown",(e=>{switch(c.enabled=!e.ctrlKey,e.code){case"KeyQ":l.setSpace("local"===l.space?"world":"local");break;case"Shift":l.setTranslationSnap(1),l.setRotationSnap(a.MathUtils.degToRad(15)),l.setScaleSnap(.25);break;case"KeyW":l.setMode("translate");break;case"KeyE":l.setMode("rotate");break;case"KeyR":l.setMode("scale");break;case"KeyC":case"KeyV":break;case"+":case"=":l.setSize(l.size+.1);break;case"-":case"_":l.setSize(Math.max(l.size-.1,.1));break;case"KeyX":l.showX=!l.showX;break;case"KeyY":l.showY=!l.showY;break;case"KeyZ":l.showZ=!l.showZ;break;case" ":l.enabled=!l.enabled;break;case"Escape":l.reset()}})),window.addEventListener("keyup",(e=>{c.enabled=!e.ctrlKey,"Shift"===e.key&&(l.setTranslationSnap(null),l.setRotationSnap(null),l.setScaleSnap(null))}))}static get Transformer(){return l}static Select(e){e?l.attach(e):l.detach()}static Update(e){c.update(e)}static FitTo({center:e,radius:t}){const s=a.MathUtils.degToRad(Workspace.Camera.fov),i=t/Math.sin(s/2),n=(new a.Vector3).subVectors(Workspace.Camera.position,e).normalize(),o=e.clone().add(n.multiplyScalar(i)),r=Workspace.Camera.position.clone();c.enabled=!1;const l=c.target.clone(),d=new Tween(l).to(e,1e3).easing(Easing.Quadratic.InOut).onUpdate((()=>{c.target.copy(l),c.getPolarAngle()>c.maxPolarAngle&&c.target.setY(e.y+Math.cos(c.maxPolarAngle)*distance)})).start(),h=new Tween(r).to(o,1e3).easing(Easing.Quadratic.InOut).onUpdate((()=>{Workspace.Camera.position.copy(r);const t=Workspace.Camera.position.distanceTo(e);t<c.minDistance?Workspace.Camera.position.copy(e.clone().add(n.clone().multiplyScalar(c.minDistance))):t>c.maxDistance&&Workspace.Camera.position.copy(e.clone().add(n.clone().multiplyScalar(c.maxDistance))),Workspace.Camera.updateProjectionMatrix(),c.update()})).onComplete((()=>{c.enabled=!0,tweengroup.remove(h,d)})).start();tweengroup.add(h,d)}},h=new a.Raycaster,u=new i.A;let p,m,g,y;const w={x:0,y:0};let f,v=.03,b=.03,A=.01,x=.01,S=window.innerWidth/2,M=window.innerHeight/2;function E(e){}function k(e){w.x=e.clientX,w.y=e.clientY,f=Date.now()}function C(e){if(Math.abs(w.x-e.clientX)>10||Math.abs(w.y-e.clientY)>10||Date.now()-f>500)return;const t=new a.Vector2,s=y.getBoundingClientRect(),i=e.clientX-s.left,o=e.clientY-s.top;t.x=i/y.clientWidth*2-1,t.y=-o/y.clientHeight*2+1,h.setFromCamera(t,m);const r=h.intersectObjects(p.children,!0);if(console.log(r),0===r.length)return;const c=[];for(let e=0;e<r.length;e++){const t=n(r[e].object);if(t.visible&&!c.includes(t))return c.push(t),void u.emit("click",t)}}const P=new Proxy(class{static get Control(){return d}static Init(e,t,s,a,i){const n={camera:{range:{x:.01,y:.01},movespeed:{x:.03,y:.03}},...i};p=a,g=s,m=t,y=e,v=n.camera.movespeed.x,b=n.camera.movespeed.y,A=n.camera.range.x,x=n.camera.range.y,S=window.innerWidth/2,M=window.innerHeight/2,e.addEventListener("click",C.bind(null)),e.addEventListener("mousemove",E,!1),e.addEventListener("mousedown",k,!1)}static Update(e){}static SetCamera(e){m=e}},{get:(e,t)=>t in e?e[t]:u[t]})},351:(e,t,s)=>{s.d(t,{A:()=>a});const a=class{constructor(){this._events={"*":[]}}subs(e,t,s){null==this._events[e]&&(this._events[e]=[]),this._events[e].push({handler:s,once:t})}on(e,t){this.subs(e,!1,t)}once(e,t){this.subs(e,!0,t)}off(e,t){const s=this._events[e];if(s){for(let e=s.length-1;e>=0;e--)s[e].handler===t&&s.splice(e,1);0===s.length&&delete this._events[e]}}clear(e){this._events[e]=[]}clearAll(){this._events={"*":[]}}emit(e,...t){const s=[];this._events[e]&&s.push(...this._events[e]),this._events["*"].length&&s.push(...this._events["*"].map((t=>({handler:t.handler.bind(this,e),once:t.once}))));for(let e=s.length-1;e>=0;e--){const a=s[e];a.handler.apply(null,t),a.once&&s.splice(e,1)}}addEventListener(e,t){this.on(e,t)}removeEventListener(e,t){this.off(e,t)}}},404:(e,t,s)=>{s.d(t,{A:()=>v});var a=s(909),i=s(351),n=s(539),o=s(304),r=s(337);let c,l,d,h,u,p,m,g=[];const y=new i.A,w=[];function f(e){for(let t=0;t<g.length;t++)g[t](e);h.render(d,p)}const v=new Proxy(class{static get Root(){return u}static get Scene(){return d}static get Camera(){return p}static get Canvas(){return c}static Init(e,t){c=e,l=new a.Clock,d=new a.Scene,h=new a.WebGLRenderer({canvas:e,alpha:!0,powerPreference:"high-performance",antialias:!0,stencil:!1});const s=c.clientWidth,i=c.clientHeight;h.setSize(s,i,!1),h.setPixelRatio(window.devicePixelRatio),h.shadowMap.enabled=!0,h.shadowMap.type=a.PCFSoftShadowMap,u=new a.Object3D,d.add(u),m=u.position.clone()}static async Start(){p=new a.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.01,1e3),p.uid="PlayCamera",d.add(p),p.position.set(0,10,20),h.setAnimationLoop(f),p.layers.enable(0),r.A.Init(h.domElement,p,d,u),console.log(d)}static AddToUpdate(e){g.push(e)}static SetCamera(e){p.visible=!1,p=e,p.aspect=window.innerWidth/window.innerHeight,p.updateProjectionMatrix(),p.visible=!0,r.A.SetCamera(p)}static async Build(e){const t=await n.$7.BuildElements(e,u);return t.forEach((e=>e.visible=!1)),w.push(...t),t}static FindBlock(e){return w.find((t=>t.uid===e))}static FindElement(e){let t=u;for(let s=0;s<e.length;s++)t=t.children.find((t=>t.uid===e[s]));return t}static async SetAsset(e,t){const s=await o.A.GetAsset({uid:t.uid}),a=e.split(".");let i=w.find((e=>e.uid===a[0]));for(let e=1;e<a.length;e++)i=i.children.find((t=>t.uid===a[e]));i.addAsset(t,s)}static RemoveAsset(e,t){const s=e.split(".");let a=w.find((e=>e.uid===s[0]));for(let e=1;e<s.length;e++)a=a.children.find((t=>t.uid===s[e]));a.removeAsset(t)}static RemoveElement(e){const t=e.split(".");let s=w;for(let e=0;e<t.length-1;e++){const a=s.find((s=>s.uid===t[e]));s=a.children}const a=s.findIndex((t=>t.path===e));if(a>=0){const e=s.splice(a,1);e[0].parent.remove(e[0])}}},{get:(e,t)=>t in e?e[t]:y[t]})},539:(e,t,s)=>{s.d(t,{$7:()=>h,C6:()=>i.A,Kx:()=>n.default});var a=s(909),i=s(30),n=s(614),o=s(304);const r={PlaneGeometry:a.PlaneGeometry,SphereGeometry:a.SphereGeometry,BoxGeometry:a.BoxGeometry,BufferGeometry:a.BufferGeometry,Group:a.Group,Object3D:a.Object3D,PerspectiveCamera:a.PerspectiveCamera,OrthographicCamera:a.OrthographicCamera,InstancedMesh:a.InstancedMesh,Mesh:a.Mesh,DirectionalLight:a.DirectionalLight,AmbientLight:a.AmbientLight,Color:a.Color,Vector3:a.Vector3,Vector2:a.Vector2,Quaternion:a.Quaternion,Matrix4:a.Matrix4,MeshLambertMaterial:a.MeshLambertMaterial,MeshPhysicalMaterial:a.MeshPhysicalMaterial,MeshStandardMaterial:a.MeshStandardMaterial,BufferAttribute:a.BufferAttribute},c=[{types:["block"],module:()=>Promise.resolve().then(s.bind(s,314))},{types:["model"],module:()=>Promise.resolve().then(s.bind(s,614))},{types:["camera"],module:()=>s.e(740).then(s.bind(s,740))},{types:["directlight"],module:()=>s.e(296).then(s.bind(s,296))},{types:["material"],module:e=>e=>{console.log(e)}},{types:["uielement"],module:()=>s.e(229).then(s.bind(s,229))}],l={},d={};class h{static AddImporter(e,t){c.push({types:e,handler:t})}static AddTemplate(e){l[e.id]=element}static AddTemplates(e){e.forEach((e=>{l[e.id]=e}))}static GetElementProp(e,t){let s=d[e];const a=t.split(".");for(let e=0;e<a.length;e++)s=s[a[e]];return s}static async UpdateElement(e,t){const s=d[e];Object.keys(t).forEach((async e=>{s[e]=await h.CreateElement(t[e])}))}static async CreateElement(e){if(null==e)return null;let t=e;if("object"==typeof e){const{type:s,properties:a,asset:i}=e;if(s){let a;const{args:i,...n}=e,l=c.find((e=>e.types.includes(s.toLowerCase())));if(l){const t=l.handler?l.handler(e):await l.module();a=t.default||t}else r[s]&&(a=r[s]);if(Array.isArray(i)){const e=await Promise.all(i.map((e=>h.CreateElement(e))));t=new a(...e)}else t=i?new a(Object.fromEntries(await Promise.all(Object.entries(i).map((async([e,t])=>[e,await h.CreateElement(t)]))))):r[s]?new a:new a(n);if(r[s]&&(t.data=e),n.assets){const e=o.A.GetAssets(n.assets.map((e=>e.uid)));t.setAssets(e,n.assets)}t.isObject3D&&(t.isElement||(t.actions=[],t.isElement=!0,t.model=t),t.paths=e.paths)}else i&&(t=await o.A.GetResource(i));a&&await Promise.all(Object.entries(a).map((async([e,s])=>{t[e]=await h.CreateElement(s)})))}return t}static async BuildElements(e,t){const s=[];for(let a=0;a<e.length;a++){const i=e[a],n=await h.BuildElement(i,t);s.push(n)}return s}static async BuildElement(e,t){const s=structuredClone(l[e.template]?{...l[e.template],...e}:JSON.parse(JSON.stringify(e))),{uid:a,name:i}=s,n=await h.CreateElement(s);if(n)return n.uid=a,n.name=i||a,n.path=t.path?`${t.path}.${a}`:a,t&&(t.addChild||t.add).bind(t)(n),e.position&&n.position.copy(e.position),e.children&&await h.BuildElements(e.children,n),d[n.uid]=n,n.init&&await n.init(),n}}},614:(e,t,s)=>{s.r(t),s.d(t,{default:()=>n});var a=s(30);class i extends a.A{constructor(e){super(e),this.isModel=!0,this.type="model"}setAssets(e,t){for(let s=0;s<t.length;s++)this.setAsset(e[s],t[s])}setAsset(e,t){const s=e.resource;e.on("update",this.updateAsset.bind(this,s)),this.add(s),this.traverse((e=>[e.visible=this.visible]))}updateAsset(e,t){this.traverse((t=>{t!==e||this.remove(t)})),this.add(t)}removeAsset(e){const t=this.children.find((t=>t.uid===e));t&&this.remove(t)}addAsset(e,t){t.position.copy(e.position||{x:0,y:0,z:0}),t.rotation.setFromVector3(e.rotation||{x:0,y:0,z:0},"XYZ"),t.scale.copy(e.scale||{x:1,y:1,z:1}),e.quaternion&&t.quaternion.copy(e.quaternion),t.traverse((e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0,e.geometry.computeBoundingBox())})),this.add(t)}}const n=i}}]);