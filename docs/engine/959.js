"use strict";(self.webpackChunk_reneos_3d_editor_engine=self.webpackChunk_reneos_3d_editor_engine||[]).push([[614,959],{410:(t,e,s)=>{s.d(e,{A:()=>n});const n=class{constructor(t){this.data=t}get uid(){return this.data.uid}}},4:(t,e,s)=>{s.d(e,{A:()=>d});var n=s(363),i=s(410);class a extends i.A{constructor(t,e){super(t),this.resource=e,this.element=null,this.elementData=null,this.applyData(this.data)}setElement(t,e={}){this.element=t,this.elementData=e,this.element.add(this.resource),this.applyData(this.data),this.applyData(this.elementData)}updateResource(t,e){this.element.children.find((t=>t.uid===this.data.uid))!==t&&(this.element.remove(this.resource),this.resource=t,this.element.add(this.resource)),this.applyData(e),this.applyData(this.elementData)}applyData(t){}destroy(){this.element.children.find((t=>t.uid===this.data.uid))&&this.element.remove(this.resource)}}const o=a,r=new Map,c={texture:()=>s.e(10).then(s.bind(s,10)),gltf:()=>Promise.all([s.e(92),s.e(824)]).then(s.bind(s,824)),hdr:()=>s.e(934).then(s.bind(s,934))},l={gltf:n.A,texture:o,hdr:o},d=class{static GetAsset(t){return r.get(t)}static async SetElement(t,e){r.get(e.uid).setElement(t,e)}static async Init(t){for(let e=0;e<t.length;e++){const s=t[e],n=await c[s.type](),i=await(n.default||n)(s),a=new l[s.type](s,i);r.set(a.uid,a)}}static RemoveAsset(t){r.has(t.uid)&&(r.get(t.uid).destroy(),r.delete(t.uid))}static async UpdateAsset(t){if(r.has(t.uid)){const e=r.get(uid),{url:s,...n}=t;if(Object.keys(n).forEach((t=>{e.data[t]=n[t]})),e.data.url!==s){const n=await c[e.data.type](),i=await(n.default||n)(s,e.data);e.updateResource(i,t),e.data.url}}}}},363:(t,e,s)=>{s.d(e,{A:()=>o});var n=s(410),i=s(4);class a extends n.A{constructor(t,e){super(t),this.resource=e,this.elements=[],this.applyData(this.data)}setElement(t,e={}){this.elements.push({element:t,data:e}),t.add(this.resource.clone()),this.applyData(e)}updateResource(t,e){for(let s=0;s<this.elements.length;s++){const s=this.elements;s.element.children.find((t=>t.uid===this.data.uid))!==t&&(s.element.remove(this.resource),this.resource=t,s.element.add(this.resource.clone())),this.applyData(e),this.applyData(s.data)}}async applyData(t){let e;console.log(t),this.resource.position.copy(t.transform?.position||{x:0,y:0,z:0}),this.resource.rotation.setFromVector3(t.transform?.rotation||{x:0,y:0,z:0},"XYZ"),this.resource.scale.copy(t.transform?.scale||{x:1,y:1,z:1}),t.transform?.quaternion&&this.resource.quaternion.copy(t.transform.quaternion),t.envMap&&(e=await i.A.GetAsset(t.envMap).resource),this.resource.traverse((s=>{s.isMesh&&(t.envMap&&(s.material.envMap=e),s.castShadow=t.shadow?.cast||!1,s.receiveShadow=t.shadow?.receive||!1,s.geometry.computeBoundingBox())}))}destroy(){for(let t=0;t<this.elements.length;t++){const t=this.elements;t.elements.children.find((t=>t.uid===this.data.uid))&&t.elements.remove(this.resource)}}}const o=a},30:(t,e,s)=>{s.d(e,{A:()=>o});var n=s(472),i=s(475);class a extends n.Object3D{static get IsElement(){return!0}constructor(t){super(),this.isElement=!0,this.uid=t.uid,this.data=t,this.type="BaseElement",this.transform=new i.A(this,!1),this.actions=t.actions||[]}get model(){return this}addElement(t,e,s,n){s===this?(this.add(e),t.transform?.position&&e.position.copy(n[t.transform.position]||t.transform.position),t.transform?.scale&&e.scale.copy(n[t.transform.scale]||t.transform.scale)):s.addElement(t,e,s,n)}}const o=a},314:(t,e,s)=>{s.r(e),s.d(e,{default:()=>a});var n=s(30);class i extends n.A{constructor(t){super(t),this.isBlock=!0,this.type="Block"}select(){this.traverse((t=>{t.isHex&&t.select()}))}unselect(){this.traverse((t=>{t.isHex&&t.unselect()}))}async show(t,e){console.log("Show"),console.log(this),this.visible=!0,t.transform?.position&&this.position.copy(t.transform.position);const s=[];for(let n=0;n<this.elements.length;n++){const i=this.elements[n],a=t.elements?t.elements.find((t=>t.uid===i.uid)):{};s.push(i.show(a,e))}await Promise.all(s)}async hide(t,e,s){console.log("hide");const n=[];for(let i=0;i<this.hidesTransitions.length;i++){const a=this.hidesTransitions[i];n.push(a(t,e,s))}await Promise.all(n),this.visible=!1;for(let t=0;t<this.onHides.length;t++)this.onHides[t]()}find(t){const e=t.split(".");let s=this,n=this.children;for(let t=0;t<e.length;t++)s=n.find((s=>s.uid===e[t])),n=s.children;return s}findElement(t){return this.elements.find((e=>e.uid===t))}}const a=i},740:(t,e,s)=>{s.r(e),s.d(e,{default:()=>o});var n=s(472),i=s(314);class a extends i.default{constructor(t){super(t),this.isCameraRoot=!0,this.camera=new n.PerspectiveCamera(t.fov||45,window.innerWidth/window.innerHeight,t.near||.01,t.far||300),this.add(this.camera),this.camera.uid="MainCamera";const e=new n.CameraHelper(this.camera);this.add(e),t.transform?.position&&this.position.copy(t.transform.position),t.transform?.rotation&&this.rotation.set(t.transform.rotation.x,t.transform.rotation.y,t.transform.rotation.z,"XYZ"),this.basePos=this.position.clone();const s=this;this.look=new Proxy(new n.Vector3,{set:function(t,e,n){return t[e]=n,s.camera.lookAt(t),!0}})}get target(){return this.look}set target(t){this.look.copy(t),this.camera.lookAt(this.look)}show(t,e,s){super.show(t,e,s),t.target&&this.camera.lookAt(t.target.x,t.target.y,t.target.z)}}const o=new Proxy(a,{get:(t,e,s)=>e in t?t[e]:t.camera[e]})},296:(t,e,s)=>{s.r(e),s.d(e,{default:()=>o});var n=s(472),i=s(30);class a extends i.A{constructor(t){super(t),console.log(t),this.isDirectLight=!0,this.type="DirectLight",this.light=new n.DirectionalLight(16777215,1),this.light.castShadow=!0,this.light.target.position.set(0,-10,20),this.light.shadow.mapSize.width=4096,this.light.shadow.mapSize.height=4096,this.light.shadow.radius=2,this.light.shadow.camera.near=.1,this.light.shadow.camera.far=500,this.light.shadow.camera.left=-50,this.light.shadow.camera.right=50,this.light.shadow.camera.top=50,this.light.shadow.camera.bottom=-50,this.light.shadow.intensity=1.8,this.add(this.light);const e=new n.DirectionalLightHelper(this.light,3);this.add(e)}}const o=a},614:(t,e,s)=>{s.r(e),s.d(e,{default:()=>o});var n=s(540),i=s(30);class a extends i.A{constructor(t,e){super(t),this.isModel=!0,this.type="Model",t.transform?.position&&this.position.copy(t.transform.position),t.transform?.rotation&&this.rotation.set(t.transform.rotation.x,t.transform.rotation.y,t.transform.rotation.z,"XYZ"),t.transform?.scale&&this.scale.copy(t.transform.scale),this.transition=t.transition,this.basePos=this.position.clone()}removeAsset(t){const e=this.children.find((e=>e.uid===t));e&&this.remove(e)}addAsset(t,e){console.log(t,e),e.position.copy(t.transform?.position||{x:0,y:0,z:0}),e.rotation.setFromVector3(t.transform?.rotation||{x:0,y:0,z:0},"XYZ"),e.scale.copy(t.transform?.scale||{x:1,y:1,z:1}),t.transform?.quaternion&&e.quaternion.copy(t.transform?.quaternion),e.traverse((t=>{t.isMesh&&(t.castShadow=!0,t.receiveShadow=!0,t.geometry.computeBoundingBox())})),this.add(e)}find(t){const e=t.split(".");let s=this;for(let t=0;t<e.length;t++)s=this.children.find((s=>s.uid===e[t])),list=s.children;return s}onHoverCall(t,e){}onOutCall(t,e){}hide(t,e,s){if(!this.transition?.hide)return;if(!s)return void(this.visible=!1);const i=s[this.transition.hide];return new Promise((s=>{const a=this.basePos.clone();let o;const r=new n.Tween(a).to(i.to,i.time||100).delay(t*i.delay||100).easing(n.Easing.Linear.InOut).onUpdate((()=>{this.position.copy(a)})).onComplete((()=>{const t=e.indexOf(o);t>=0&&e.splice(t,1),this.visible=!1,s()}));o=r.update.bind(r),r.start(),e.push(o)}))}show(t,e){console.log("Show element "+t),console.log(this.position)}}const o=a},475:(t,e,s)=>{s.d(e,{A:()=>n});const n=class{constructor(t,e=!1){this.model=t,e&&(this._position={x:this.model.position.x,y:this.model.position.y,z:this.model.position.z},this._rotation={x:this.model.rotation.x,y:this.model.rotation.y,z:this.model.rotation.z},this._scale={x:this.model.scale.x,y:this.model.scale.y,z:this.model.scale.z}),this._reactive=null}create(t,e){this[`_${t}`]=e}clean(t){delete this[`_${t}`]}update({position:t,rotation:e,scale:s}){this._reactive.position=this._position={x:t.x,y:t.y,z:t.z},this._reactive.rotation=this._rotation={x:e.x,y:e.y,z:e.z},this._reactive.scale=this._scale={x:s.x,y:s.y,z:s.z}}get position(){return this._position}set position(t){this._position=t,this.model.position.copy(this._position)}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this.model.rotation.set(this._rotation.x,this._rotation.y,this._rotation.z,"XYZ")}get scale(){return this._scale}set scale(t){this._scale=t,this.model.scale.copy(this._scale)}}},670:(t,e,s)=>{s.r(e),s.d(e,{ActionsManager:()=>et,AssetsManager:()=>l.A,BaseElement:()=>a.A,ElementModel:()=>o.default,Factory:()=>f,MouseManager:()=>I,ProjectManager:()=>$,SlidesManager:()=>rt,THREE:()=>i});var n=s(472),i=s.t(n,2),a=s(30),o=(s(314),s(614)),r=(s(296),s(540));function c(t){for(;t;){if(t.isBlock)return t;t=t.parent}return null}s(183),new n.Color(16711680),new n.Color(16744192),new n.Color(16776960),new n.Color(65280),new n.Color(255),new n.Color(4915330),new n.Color(9109759),a.A,s(74),a.A,s(740);var l=s(4),d=s(475);const h={PlaneGeometry:n.PlaneGeometry,SphereGeometry:n.SphereGeometry,BoxGeometry:n.BoxGeometry,BufferGeometry:n.BufferGeometry,Group:n.Group,Object3D:n.Object3D,PerspectiveCamera:n.PerspectiveCamera,OrthographicCamera:n.OrthographicCamera,InstancedMesh:n.InstancedMesh,Mesh:n.Mesh,DirectionalLight:n.DirectionalLight,AmbientLight:n.AmbientLight,Color:n.Color,Vector3:n.Vector3,Vector2:n.Vector2,Quaternion:n.Quaternion,Matrix4:n.Matrix4,MeshLambertMaterial:n.MeshLambertMaterial,MeshPhysicalMaterial:n.MeshPhysicalMaterial,MeshStandardMaterial:n.MeshStandardMaterial,BufferAttribute:n.BufferAttribute},m=[{types:["block"],module:()=>Promise.resolve().then(s.bind(s,314))},{types:["model"],module:()=>Promise.resolve().then(s.bind(s,614))},{types:["camera"],module:()=>Promise.resolve().then(s.bind(s,740))},{types:["directlight"],module:()=>Promise.resolve().then(s.bind(s,296))}],p={},u={};class f{static GetElementProp(t,e){let s=u[t];const n=e.split(".");for(let t=0;t<n.length;t++)s=s[n[t]];return s}static async UpdateElement(t,e){const s=u[t];Object.keys(e).forEach((async t=>{s[t]=await f.CreateElement(e[t])}))}static async CreateElement(t){if(null==t)return null;let e=t;if("object"==typeof t){const{type:s,properties:n}=t;if(s){const{args:n=[],...i}=t,a=m.find((t=>t.types.includes(s.toLowerCase())));if(a){const t=await a.module(),s=t.default||t;e=new s(i),i.assets&&i.assets.forEach((async t=>{await l.A.SetElement(e,t)}))}else if(h[s]){const t=h[s];if(Array.isArray(n)){const s=await Promise.all(n.map((t=>f.CreateElement(t))));e=new t(...s)}else{const s=Object.fromEntries(await Promise.all(Object.entries(n).map((async([t,e])=>[t,await f.CreateElement(e)]))));e=new t(s)}e.isObject3D&&(e.isElement=!0,e.transform=new d.A(e,!0))}}if(n){const t=Object.keys(n);for(let s=0;s<t.length;s++){const i=t[s];e[i]=await f.CreateElement(n[i])}}}return e}static async BuildElements(t,e){const s=[];for(let n=0;n<t.length;n++){const i=t[n],a=await f.BuildElement(i,e);s.push(a)}return s}static async BuildElement(t,e){const s=structuredClone(p[t.template]?{...p[t.template],...t}:JSON.parse(JSON.stringify(t))),{uid:i,name:a,transform:o={},childrens:r=[]}=s,c=await f.CreateElement(s);if(!c)return;c.uid=i,c.name=a,c.path=e.path?`${e.path}.${i}`:i,e&&(e.addChild||e.add).bind(e)(c);const l={position:new n.Vector3(0,0,0),quaternion:new n.Quaternion(0,0,0,1),scale:new n.Vector3(1,1,1)};return o.position&&l.position.copy(o.position),c.position.copy(l.position),o.quaternion&&l.quaternion.copy(o.quaternion),c.quaternion.copy(l.quaternion),o.scale&&l.scale.copy(o.scale),c.scale.copy(l.scale),t.childrens&&await f.BuildElements(t.childrens,c),u[c.uid]=c,c.init&&await c.init(),c}static RegisterComponents(t){t.map((t=>{Components[t.type]=t.handler}))}static async CreateComponent(t,e,s={}){const n=Components[t];if(!n)return void console.warn(`Cant find ${t}`);const i=new n(e,s);return e.addComponents?e.addComponents(i):(e.components||(e.components=[]),e.components.push(i)),i}static CreateComponents(t,e=[]){return Promise.all(e.map((({type:e,data:s})=>f.CreateComponent(e,t,s))))}static AddImporter(t,e){m.push({types:t,handler:e})}static AddTemplate(t){p[t.id]=element}static AddTemplates(t){t.forEach((t=>{p[t.id]=t}))}}const y=class{constructor(){this._events={"*":[]}}subs(t,e,s){null==this._events[t]&&(this._events[t]=[]),this._events[t].push({handler:s,once:e})}on(t,e){this.subs(t,!1,e)}once(t,e){this.subs(t,!0,e)}off(t,e){const s=this._events[t];if(s){for(let t=s.length-1;t>=0;t--)s[t].handler===e&&s.splice(t,1);0===s.length&&delete this._events[t]}}clear(t){this._events[t]=[]}clearAll(){this._events={"*":[]}}emit(t,...e){const s=[];this._events[t]&&s.push(...this._events[t]),this._events["*"].length&&s.push(...this._events["*"].map((e=>({handler:e.handler.bind(this,t),once:e.once}))));for(let t=s.length-1;t>=0;t--){const n=s[t];n.handler.apply(null,e),n.once&&s.splice(t,1)}}addEventListener(t,e){this.on(t,e)}removeEventListener(t,e){this.off(t,e)}};var w=s(24),g=s(0);let v,b;const x=new r.Group,E=class{static MoveTo(t,e){const s={position:new n.Vector3,time:1e3,...t,control:!1},i={position:new n.Vector3,time:1e3,...e,control:!1};v.enabled=!1;const a=Workspace.Camera.position.clone(),o=v.target.clone();s.control=s.time>i.time,i.control=i.time>=s.time;const c=new r.Tween(a).to(s.position,s.time).easing(r.Easing.Quadratic.InOut).onUpdate((()=>{Workspace.Camera.position.copy(a),Workspace.Camera.updateProjectionMatrix(),v.update()})).onComplete((()=>{s.control&&(v.enabled=!0),x.remove(c)})).start(),l=new r.Tween(o).to(i.position,i.time).easing(r.Easing.Quadratic.InOut).onUpdate((()=>{v.target.copy(o),v.getPolarAngle()>v.maxPolarAngle&&v.target.setY(center.y+Math.cos(v.maxPolarAngle)*distance)})).onComplete((()=>{i.control&&(v.enabled=!0),x.remove(l)})).start();x.add(c,l)}static SetState(t){v.enabled=t}static Init({canvas:t},e,s){v=new w.N(e,t),v.enabled=!0,v.enableDamping=!0,v.dampingFactor=.25,v.screenSpacePanning=!1,v.minDistance=.01,v.maxDistance=500,b=new g.ZU(e,t),b.addEventListener("dragging-changed",(t=>{v.enabled=!t.value}));const i=b.getHelper();s.add(i),b.getRaycaster().layers.set(1),i.traverse((t=>{t.layers.set(1)})),window.addEventListener("keydown",(t=>{switch(v.enabled=!t.ctrlKey,console.log(t.code),t.code){case"KeyQ":b.setSpace("local"===b.space?"world":"local");break;case"Shift":b.setTranslationSnap(1),b.setRotationSnap(n.MathUtils.degToRad(15)),b.setScaleSnap(.25);break;case"KeyW":b.setMode("translate");break;case"KeyE":b.setMode("rotate");break;case"KeyR":b.setMode("scale");break;case"KeyC":case"KeyV":break;case"+":case"=":b.setSize(b.size+.1);break;case"-":case"_":b.setSize(Math.max(b.size-.1,.1));break;case"KeyX":b.showX=!b.showX;break;case"KeyY":b.showY=!b.showY;break;case"KeyZ":b.showZ=!b.showZ;break;case" ":b.enabled=!b.enabled;break;case"Escape":b.reset()}})),window.addEventListener("keyup",(t=>{v.enabled=!t.ctrlKey,"Shift"===t.key&&(b.setTranslationSnap(null),b.setRotationSnap(null),b.setScaleSnap(null))}))}static get Transformer(){return b}static Select(t){t?b.attach(t):b.detach()}static Update(t){v.update(t)}static FitTo({center:t,radius:e}){const s=n.MathUtils.degToRad(Workspace.Camera.fov),i=e/Math.sin(s/2),a=(new n.Vector3).subVectors(Workspace.Camera.position,t).normalize(),o=t.clone().add(a.multiplyScalar(i)),c=Workspace.Camera.position.clone();v.enabled=!1;const l=v.target.clone(),d=new r.Tween(l).to(t,1e3).easing(r.Easing.Quadratic.InOut).onUpdate((()=>{v.target.copy(l),v.getPolarAngle()>v.maxPolarAngle&&v.target.setY(t.y+Math.cos(v.maxPolarAngle)*distance)})).start(),h=new r.Tween(c).to(o,1e3).easing(r.Easing.Quadratic.InOut).onUpdate((()=>{Workspace.Camera.position.copy(c);const e=Workspace.Camera.position.distanceTo(t);e<v.minDistance?Workspace.Camera.position.copy(t.clone().add(a.clone().multiplyScalar(v.minDistance))):e>v.maxDistance&&Workspace.Camera.position.copy(t.clone().add(a.clone().multiplyScalar(v.maxDistance))),Workspace.Camera.updateProjectionMatrix(),v.update()})).onComplete((()=>{v.enabled=!0,x.remove(h,d)})).start();x.add(h,d)}},A=new n.Raycaster,C=new y;let S,M,k;const P={x:0,y:0};let _,D=.03,z=.03,R=.01,B=.01,O=window.innerWidth/2,T=window.innerHeight/2;function L(t){}function j(t){P.x=t.clientX,P.y=t.clientY,_=Date.now()}function G(t){if(Math.abs(P.x-t.clientX)>10||Math.abs(P.y-t.clientY)>10||Date.now()-_>500)return;const e=t.clientX/window.innerWidth,s=-t.clientY/window.innerHeight,i=new n.Vector2;i.x=2*e-1,i.y=2*s+1,A.setFromCamera(i,M);const a=A.intersectObjects(S.children,!0);if(0===a.length)return E.Select(null),void C.emit("click",null);const o=[];for(let t=0;t<a.length;t++){const e=c(a[t].object);if(!o.includes(e))return o.push(e),void C.emit("click",e)}}const I=new Proxy(class{static Select(t){E.Select(t)}static Init(t,e,s,n,i){const a={camera:{range:{x:.01,y:.01},movespeed:{x:.03,y:.03}},...i};S=n,k=s,M=e,D=a.camera.movespeed.x,z=a.camera.movespeed.y,R=a.camera.range.x,B=a.camera.range.y,O=window.innerWidth/2,T=window.innerHeight/2,t.addEventListener("click",G.bind(null)),t.addEventListener("mousemove",L,!1),t.addEventListener("mousedown",j,!1),E.Init({canvas:t},M,k),E.Transformer.addEventListener("objectChange",(t=>{C.emit("transformate",E.Transformer.object)}))}static Update(t){E.Update()}static SetCamera(t){M=t}},{get:(t,e)=>e in t?t[e]:C[e]});let W,q,U,H,V,Y,X;const F=new y,K=[];function Z(t){I.Update(),H.render(U,Y)}const $=new Proxy(class{static get Root(){return V}static get Scene(){return U}static Init(t,e=!1){console.log("Project init"),W=t,q=new n.Clock,U=new n.Scene,H=new n.WebGLRenderer({canvas:t,alpha:!0,powerPreference:"high-performance",antialias:!0,stencil:!1});const s=W.clientWidth,i=W.clientHeight;H.setSize(s,i,!1),H.setPixelRatio(window.devicePixelRatio),H.shadowMap.enabled=!0,H.shadowMap.type=n.PCFSoftShadowMap,V=new n.Object3D,U.add(V),X=V.position.clone();const a=new n.PlaneGeometry(30,30,32,32),o=new n.MeshStandardMaterial({color:65280}),r=new n.Mesh(a,o);r.receiveShadow=!0,r.rotateX(n.MathUtils.degToRad(-90)),U.add(r)}static async Start(){console.log("Project Start"),Y=new n.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.01,1e3),Y.uid="EditorCamera",U.add(Y),I.Init(H.domElement,Y,U,V),Y.position.set(0,10,20),H.setAnimationLoop(Z),Y.layers.enable(1),U.background=await l.A.GetAsset("hdrscene").resource}static async Build(t){const e=await f.BuildElements(t,V);return e.forEach((t=>t.visible=!1)),K.push(...e),e}static FindBlock(t){return K.find((e=>e.uid===t))}static async SetAsset(t,e){const s=await l.A.GetAsset({uid:e.uid}),n=t.split(".");let i=K.find((t=>t.uid===n[0]));for(let t=1;t<n.length;t++)i=i.children.find((e=>e.uid===n[t]));i.addAsset(e,s)}static RemoveAsset(t,e){const s=t.split(".");let n=K.find((t=>t.uid===s[0]));for(let t=1;t<s.length;t++)n=n.children.find((e=>e.uid===s[t]));n.removeAsset(e)}static RemoveElement(t){const e=t.split(".");let s=K;for(let t=0;t<e.length-1;t++){const n=s.find((s=>s.uid===e[t]));s=n.children}const n=s.findIndex((e=>e.path===t));if(n>=0){const t=s.splice(n,1);t[0].parent.remove(t[0])}}},{get:(t,e)=>e in t?t[e]:F[e]}),Q=new r.Group,N={};let J={},tt=!1;const et=class{static Init(t){J=t,Object.values(J).forEach((t=>{t.handler=N[t.type]})),tt=!0,function t(e){tt&&(Q.update(e),requestAnimationFrame(t))}()}static RegisterAction(t,e){N[t]=e,Object.values(J).forEach((e=>{e.type===t&&(e.handler=N[e.type])}))}static async Execute(t,e){const s=[];for(let n=0;n<t.length;n++){const i=t[n];i.actions.filter((t=>t.tween)).forEach((t=>{t.tween.stop(),Q.remove(t.tween)})),i.model.actions.filter((t=>t.tween)).forEach((t=>{t.tween.stop(),Q.remove(t.tween)}));const a=i.actions.filter((t=>t.hook===e));i.model.actions.filter((t=>t.hook===e)).forEach((t=>{const e=J[t.uid];s.push(e.handler(e,i,Q,t))})),a.forEach((t=>{const e=J[t.uid];s.push(e.handler(e,i,Q,t))}))}console.log(`${e} : Run ${s.length}`),await Promise.all(s)}static Stop(t,e){for(let s=0;s<t.length;s++){const n=t[s];e.includes(n)||n.actions.forEach((t=>{t.tween&&(t.tween.stop(),Q.remove(t.tween))}))}}static Run(t){}static RunAction(){}},st=[];let nt;class it{static AddSlides(t){const e=[];for(let s=0;s<t.length;s++){const n=it.AddSlide(t[s]);e.push(n)}return e}static AddSlide(t){const e=new at(t);for(let s=0;s<t.states.length;s++){const n=t.states[s];console.log(n);const i=new ot(n,$.FindBlock(n.uid));n.transform&&i.setTransform(n.transform),i.transform._reactive=i.transform,e.addState(i)}return st.push(e),e}static AddState(t,e=!0){const s=new ot(t,$.FindBlock(t.uid));return e&&(s.model.visible=!0),s}static UpdateState(t,e,s){st.find((e=>e.uid===t)).states.find((t=>t.uid===e)).update(s)}static RemoveState(t,e){for(let s=0;s<st.length;s++){const n=st[s];if(e&&n.uid!==e)continue;const i=n.states.findIndex((e=>e.path===t));if(i>=0){const t=n.states.splice(i,1);e&&t.forEach((t=>t.model.visible=!1))}}}static GoTo(t){if(nt?.uid===t)return;const e=st.find((e=>e.uid===t));it.Activate(e)}static async Activate(t){console.log(`Activate ${t.uid}`);let e=[];nt&&(nt.ready=!1,e=nt.states,await nt.out(t.states)),nt=t,await nt.in(e)}}class at{constructor(t){this.uid=t.uid,this.name=t.name,this.scene=t.scene,this.type=t.type||"Slide",this.isSlide=!0,this.states=[],this.ready=!0}addState(t){this.states.push(t)}async in(t){console.log(`${Date.now()} : in`);const e=[],s=[];for(let n=0;n<this.states.length;n++){const i=this.states[n];t.findIndex((t=>t.uid===i.uid))>=0?s.push(i):e.push(i)}const n=[...e,...s];n.forEach((t=>{t.model.position.copy(t.transform.position||t.model.transform.position||t.model.position);const e=t.transform.rotation||t.model.transform.rotation||t.model.rotation;t.model.rotation.set(e.x,e.y,e.z,"XYZ"),t.model.scale.copy(t.transform.scale||t.model.transform.scale||t.model.scale)})),e.forEach((t=>t.activate())),await et.Execute(e,"enable.on"),await et.Execute(n,"slide.in")}async out(t){console.log("out");const e=[],s=[];for(let n=0;n<this.states.length;n++){const i=this.states[n];t.findIndex((t=>t.uid===i.uid))>=0?e.push(i):s.push(i)}await et.Execute([...s,...e],"slide.out"),await et.Execute(s,"disable.on"),s.forEach((t=>t.deactivate()))}}class ot{constructor(t,e){this.uid=e.uid,this.path=e.path,this.isState=!0,this.type="State",this.model=e,this.transform=new d.A(e),this.actions=t.actions||[]}setTransform(t){t.position&&(this.transform.position=t.position),t.scale&&(this.transform.scale=t.scale),t.rotation&&this.model.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z,"XYZ"),t.quaternion&&this.model.quaternion.copy(t.quaternion)}async activate(){this.model.visible=!0}deactivate(){this.model.visible=!1}}const rt=it}}]);